

var LANG_MSG = {
"es":{
"trans_no_disponible":"No disponible para este dispositivo",
"trans_no_comenzado" : "La retransmisión aún no ha comenzado",
"trans_reanudara" : "La retransmisión se reanudará en breve",
"trans_finalizada" : "La retransmisión ha finalizado",
"trans_no_activa" : "Retransmisión no activa",
"publicidad" : "Publicidad",
"actualizar_plugin" : "Necesitas actualizar tu plugin de Flash",
"no_mp4" : "El navegador no admite vídeo HTML5/MP4",
"no_mp3" : "El navegador no admite audio HTML5/MP3",
"geobloqueado" : "Vídeo no disponible en su zona geográfica",
"bloqueado" : "Contenido compartido bloqueado",
"aun_no_disponible" : "El vídeo no está disponible todavía",
"no_disponible" : "El vídeo ya no está disponible",
"audio_geobloqueado" : "Audio no disponible en su zona geográfica",
"audio_aun_no_disponible" : "Audio no disponible todavía",
"audio_no_disponible" : "Audio ya no disponible",
"audio_no_encontrado": "Audio no encontrado",
"necesita_plugin" : "Necesita instalar el plugin de flash para ver este contenido",
"no_encontrado": "Vídeo no encontrado",
"cerrar" : "Cerrar",
"tamanio_real" : "Tamaño real",
"ver_perfil_eskup" : "Ver perfil en Eskup",
"teclear_usuario" : "Tienes que teclear usuario y contraseña",
"error_correo" : "El campo 'usuario' no parece un correo electrónico. Por favor, revísalo.",
"foto" : "Foto",
"tamanio_ventana" : "Tamaño ventana",
"ver_perfil_completo" : "Ver perfil completo",
"avatar" : "Avatar",
"ver_video": "Ver vídeo",
"vervideo_svg": "//ep00.epimg.net/reproductores/vervideo.svg",
"directo":"EMISIÓN EN DIRECTO",
"siguiente_noticia": "Siguiente noticia",
"anterior_noticia": "Noticia anterior",
"primera_noticia": "No hay noticia anterior",
"ultima_noticia": "No hay más noticias"
},
"pt-br":{
"trans_no_disponible":"Indisponível para este dispositivo",
"trans_no_comenzado" : "La retransmisión aún no ha comenzado",
"trans_reanudara" : "La retransmisión se reanudará en breve",
"trans_finalizada" : "La retransmisión ha finalizado",
"trans_no_activa" : "Retransmisión no activa",
"publicidad" : "Publicidade",
"actualizar_plugin" : "Você precisa atualizar seu plugin Flash",
"no_mp4" : "O navegador não suporta vídeo HTML5/MP4",
"no_mp3" : "O navegador não suporta HTML5/MP3",
"geobloqueado" : "Vídeo não disponível para sua região",
"bloqueado" : "Contenido compartido bloqueado",
"aun_no_disponible" : "O vídeo ainda não está disponível",
"no_disponible" : "O vídeo não está mais disponível",
"audio_geobloqueado" : "Audio no disponible en su zona geográfica",
"audio_aun_no_disponible" : "Audio no disponible todavía",
"audio_no_disponible" : "Audio ya no disponible",
"audio_no_encontrado": "Audio no encontrado",
"necesita_plugin" : "Você precisa instalar o plugin flash para ver este conteúdo",
"no_encontrado": "Vídeo não encontrado",
"cerrar" : "Fechar",
"tamanio_real" : "Tamanho real",
"ver_perfil_eskup" : "Ver perfil em Eskup",
"teclear_usuario" : "Digite usuário e senha",
"error_correo" : "O campo 'usuário' não parece ser um e-mail. Por favor, verifique",
"foto" : "Foto",
"tamanio_ventana" : "Tamanho Janela",
"ver_perfil_completo" : "Ver perfil completo",
"avatar" : "Avatar",
"ver_video": "Ver vídeo",
"vervideo_svg": "//ep00.epimg.net/reproductores/vervideo_pt-br.svg",
"directo":"AO VIVO",
"siguiente_noticia": "Próxima notícia",
"anterior_noticia": "Notícias anteriores",
"primera_noticia": "Nenhuma notícia anterior",
"ultima_noticia": "Sem mais notícias"
},
"ca":{
"trans_no_disponible":"Transmissió no disponible per a aquest dispositiu",
"trans_no_comenzado" : "La retransmissió encara no ha començat",
"trans_reanudara" : "La retransmissió es reprendrà aviat",
"trans_finalizada" : "La retransmissió ha finalitzat",
"trans_no_activa" : "Retransmisión no activa",
"publicidad" : "Publicitat",
"actualizar_plugin" : "Necessites actualitzar el teu plugin de Flash",
"no_mp4" : "El navegador no admet vídeo HTML5/MP4",
"no_mp3" : "El navegador no admet HTML5/MP3",
"geobloqueado" : "Vídeo no disponible en la seva zona geogràfica",
"bloqueado" : "Contingut compartit bloquejat",
"aun_no_disponible" : "El vídeo encara no està disponible",
"no_disponible" : "El vídeo ja no està disponible",
"audio_geobloqueado" : "Áudio no disponible en la seva zona geogràfica",
"audio_aun_no_disponible" : "Àudio no disponible encara",
"audio_no_disponible" : "Àudio ja no disponible",
"audio_no_encontrado": "Áudio no trobat",
"necesita_plugin" : "Necessita instal·lar el plugin de Flash per veure aquest contingut",
"no_encontrado": "Vídeo no trobat",
"cerrar" : "Tancar",
"tamanio_real" : "Mida real",
"ver_perfil_eskup" : "Veure perfil en Eskup",
"teclear_usuario" : "Has de teclejar usuari i contrasenya",
"error_correo" : "El camp 'usuari' no sembla un correu electrònic. Sisplau, revisa'l",
"foto" : "Foto",
"tamanio_ventana" : "Mida finestra",
"ver_perfil_completo" : "Veure perfil complet",
"avatar" : "Avatar",
"ver_video": "Veure Vídeo",
"vervideo_svg": "//ep00.epimg.net/reproductores/vervideo_ca.svg",
"directo":"EMISSIÓ EN DIRECTE",
"siguiente_noticia": "Propera notícia",
"anterior_noticia": "Notícia anterior",
"primera_noticia": "No hi ha notícia anterior",
"ultima_noticia": "No hi ha més notícies"
}
};
var MPEP_idioma = "es";
var MPEP_responsive = (typeof(MPEP_responsive) != "undefined") ? MPEP_responsive : false;
function parseaMetas() {
var metas = document.getElementsByTagName('meta');
var idioma_meta = "";
var i;
for (i=0; i<metas.length; i++) {
if (metas[i].getAttribute("name") == "lang") {
idioma_meta = (metas[i].getAttribute("content")).toLowerCase();
}
if (metas[i].getAttribute("name") == "viewport")
MPEP_responsive = true;
}
if ( LANG_MSG.hasOwnProperty(idioma_meta) ) {
MPEP_idioma = idioma_meta;
}
}
parseaMetas();
if (typeof(LANG) == "undefined")
var LANG = MPEP_idioma;
else
{
if ( !LANG_MSG.hasOwnProperty(LANG) )
{
LANG = "es";
}
}

var isOpera = null;
var isSafari = null;
var isGecko = null;
var isIE = null;
var isMobile = null;
var userAgent = navigator.userAgent.toLowerCase();
var ua=navigator.userAgent, userAgentMatches;
if ((/KHTML/).test(ua)) {
isSafari=1;
}
userAgentMatches=ua.match(/AppleWebKit\/([^\s]*)/);
if (userAgentMatches&&userAgentMatches[1]) {
isSafari=parseFloat(userAgentMatches[1]);
}
if (!isSafari) {
userAgentMatches=ua.match(/Opera[\s\/]([^\s]*)/);
if (userAgentMatches&&userAgentMatches[1]) {
isOpera=parseFloat(userAgentMatches[1]);
} else {
userAgentMatches=ua.match(/MSIE\s([^;]*)/);
if (userAgentMatches&&userAgentMatches[1]) {
isIE=parseFloat(userAgentMatches[1]);
} else {
userAgentMatches=ua.match(/Gecko\/([^\s]*)/);
if (userAgentMatches) {
isGecko=1;
}
}
}
}
if (typeof(getInternetExplorerVersion) == "undefined")
{
getInternetExplorerVersion = function(){
var rv = 0;
if (navigator.appName == 'Microsoft Internet Explorer')
{
var ua = navigator.userAgent;
var re  = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
if (re.exec(ua) != null)
rv = parseFloat( RegExp.$1 );
}
else if (navigator.appName == 'Netscape')
{
var ua = navigator.userAgent;
var re  = new RegExp("Trident/.*rv:([0-9]{1,}[\.0-9]{0,})");
if (re.exec(ua) != null)
rv = parseFloat( RegExp.$1 );
}
return rv;
}
}
var IEv = getInternetExplorerVersion();
var isIphone = false;
var isIpad = false;
if (userAgent.indexOf("iphone") > -1)
isIphone = true
else
if (userAgent.indexOf("ipad") > -1)
isIpad = true;
var iDevice = (isIphone || isIpad);
var dispositivoMovil = iDevice || userAgent.indexOf("android") > -1 || userAgent.indexOf("mobile") > -1;
var dimensionesPEP = EPETBrowserDims();
if (typeof(anchoReferenciaMobile) == "undefined" )
var anchoReferenciaMobile = 600;
var ev_reescalado;
EPETaddEvent(window, orientationEvent, function(){
clearTimeout(ev_reescalado);
ev_reescalado = setTimeout( function() {
dimensionesPEP = EPETBrowserDims();
}, 300)
});

if (typeof(UN) == "undefined" )
var UN = "ep";

var versionMovil = document.location.pathname.indexOf("/m/") == 0;

if (typeof(url_cache) == "undefined" )
var url_cache = "//ep02.epimg.net";
var datosMPEP = {"urlCacheMPEP":url_cache};
if (typeof(css_multimedia) == "undefined" )
var css_multimedia = "//ep00.epimg.net/estilos/multimedia/multimedia.css";
if (typeof(url_reproductor_epet) == "undefined" )
var url_reproductor_epet = "/reproductores/playerPEP.swf";
if (typeof(url_reproductor_epet_live) == "undefined" )
var url_reproductor_epet_live = "/reproductores/playerPEP_live.swf";
if (typeof(simplemediaplayer_mediateca_PEP) == "undefined" )
var simplemediaplayer_mediateca_PEP = "//playertop.elpais.com/psdmedia/media/simple/js/SimpleMediaPlayer.min.js";
if (typeof(id_player_mediateca_PEP) == "undefined" )
var id_player_mediateca_PEP = "141";
if (typeof(id_cuenta_mediateca_PEP) == "undefined" )
var id_cuenta_mediateca_PEP = "elpais";
if (typeof(tipo_player_mediateca_PEP) == "undefined" )
var tipo_player_mediateca_PEP = "mediateca";
var mediateca = null;
var videosMediateca = [];
if (typeof(mediateca_activo_PEP) != "undefined" && mediateca_activo_PEP)
{
var PSDss = document.createElement("script");
PSDss.type= 'text/javascript';
PSDss.onload = function(){
mediateca = mediateca || new psd.media.TopEmbedManager();
for(var i=0; i<videosMediateca.length;i++)
{
mediateca.add(videosMediateca[i].datosTOP, videosMediateca[i].params);
}
}
PSDss.src = simplemediaplayer_mediateca_PEP;
document.getElementsByTagName('head')[0].appendChild(PSDss);
}
if (typeof(UrlPublicidad) == "undefined")
var UrlPublicidad = "//pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=%2F7811748%2Felpais_web%2Fplayer_video%2Fflash&ciu_szs=&impl=s&gdfp_req=1&env=vp&output=vast&correlator={random}&unviewed_position_start=1";
if (typeof(UrlPublicidadOveron) == "undefined")
var UrlPublicidadOveron = "//pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=%2F7811748%2Foveron_player%2Felpais_web%2Fflash&ciu_szs=&impl=s&gdfp_req=1&env=vp&output=vast&correlator={random}&unviewed_position_start=1";
if (typeof(UrlPublicidadCnbc) == "undefined")
var UrlPublicidadCnbc = "//pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=%2F7811748%2Felpais_cnbc_player_web%2Fflash&ciu_szs=&impl=s&gdfp_req=1&env=vp&output=vast&correlator={random}&unviewed_position_start=1";
if (typeof(postroll_HTML5) == "undefined")
var postroll_HTML5 = true;
if (typeof(publicidad_HTML5) == "undefined")
var publicidad_HTML5 = true;
if (typeof(modoSiguientesVideos) == "undefined")
var modoSiguientesVideos = 0;
if (typeof(modoSiguientesVideosTimeout) == "undefined")
var modoSiguientesVideosTimeout = 5;
if (typeof(controlesNativosAudio) == "undefined")
var controlesNativosAudio = false;
if (typeof(controlesNativosVideo) == "undefined")
var controlesNativosVideo = false;
if (typeof(orden_busqueda_url_externa) == 'undefined')
var orden_busqueda_url_externa = ["muzu","youtube"];
var code_ima3_HTML5_cargado = "nocargado";
var volumen_global = 1;
function arreglaUrl(url)
{
var result;
if (!url.match(/youtu/i))
{
if (url.match(/muzu/i))
url = url.replace("/a/","/i/");
else if(url.match(/vimeo/i)){
if(url.match(/player/i)){
return url;
}else{
var reg = /\/\d*$/;
var idVimeo = reg.exec(url);
if(idVimeo[0]) return "//player.vimeo.com/video"+idVimeo[0];
}
}
return url;
}
else
{
var esYT = /youtube.*\/embed\//i;
if (!esYT.test(url))
{
var reg = /([^\/]*\/\/[^\/]*youtube[^\/]*)\/.*v=([^&]+)/i;
result = reg.exec(url);
if (result)
{
return result[1] + "/embed/" + result[2];
}
else
{
var esYTCorta = /\/\/youtu\.be\/([^\?\/]+)/
result = esYTCorta.exec(url);
if (result)
return "//www.youtube.com/embed/" + result[1];
}
}
return url;
}
}
if (typeof(eligeUrlenlace) == 'undefined')
{
function eligeUrlenlace(arrayUrls)
{
var n = arrayUrls.length;
if (n == 0)
return "";
if (n == 1)
return arreglaUrl(arrayUrls[0]);
var re;
var regexp;
var cadena_urls;
var result;
cadena_urls = "||" + arrayUrls.join("||") + "||";
for (i=0; i< orden_busqueda_url_externa.length; i++)
{
re = "/" + "\\|\\|([^\\/]*\\/\\/[^\\/]*" + orden_busqueda_url_externa[i] + "[^\\/]*\\/?[^\\|\\|]*)\\|\\|" + "/";
regexp = new RegExp(eval(re));
result = regexp.exec(cadena_urls);
if (result)
{
return arreglaUrl(result[1]);
}
}
return arreglaUrl(arrayUrls[0]);
}
}
var PAGE_TITLE = (document.getElementsByTagName('title')[0] ) ? document.getElementsByTagName('title')[0].innerHTML.replace(/'|"|\|/g, "") : "sin título";
var supportsOrientationChange = "onorientationchange" in window;
var orientationEvent = supportsOrientationChange ? "orientationchange" : "resize";
var connectionPEP = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
var FlashDetect = new function(){
var self = this;
self.release = "1.0.2";
self.installed = false;
self.major = -1;
self.minor = -1;
self.revision = -1;
self.revisionStr = "";
self.activeXVersion = "";
var activeXDetectRules = [
{
"name":"ShockwaveFlash.ShockwaveFlash.7",
"version":function(obj){
return getActiveXVersion(obj);
}
},
{
"name":"ShockwaveFlash.ShockwaveFlash.6",
"version":function(obj){
var version = "6,0,21";
try{
obj.AllowScriptAccess = "always";
version = getActiveXVersion(obj);
}catch(err){}
return version;
}
},
{
"name":"ShockwaveFlash.ShockwaveFlash",
"version":function(obj){
return getActiveXVersion(obj);
}
}
];
var getActiveXVersion = function(activeXObj){
var version = -1;
try{
version = activeXObj.GetVariable("$version");
}catch(err){}
return version;
};
var getActiveXObject = function(name){
var obj = -1;
try{
obj = new ActiveXObject(name);
}catch(err){}
return obj;
};
var parseActiveXVersion = function(str){
var versionArray = str.split(",");
return {
"major":parseInt(versionArray[0].split(" ")[1], 10),
"minor":parseInt(versionArray[1], 10),
"revision":parseInt(versionArray[2], 10),
"revisionStr":versionArray[2]
};
};
var parseRevisionStrToInt = function(str){
return parseInt(str.replace(/[a-zA-Z]/g, ""), 10) || self.revision;
};
self.majorAtLeast = function(version){
return self.major >= version;
};
self.FlashDetect = function(){
if(navigator.plugins && navigator.plugins.length>0){
var type = 'application/x-shockwave-flash';
var mimeTypes = navigator.mimeTypes;
if(mimeTypes && mimeTypes[type] && mimeTypes[type].enabledPlugin && mimeTypes[type].enabledPlugin.description){
var desc = mimeTypes[type].enabledPlugin.description;
var descParts = desc.split(' ');
var majorMinor = descParts[2].split('.');
self.major = parseInt(majorMinor[0], 10);
self.minor = parseInt(majorMinor[1], 10);
self.revisionStr = descParts[3];
self.revision = parseRevisionStrToInt(self.revisionStr);
self.installed = true;
}
}else if(navigator.appVersion.indexOf("Mac")==-1 && window.execScript){
var version = -1;
for(var i=0; i<activeXDetectRules.length && version==-1; i++){
var obj = getActiveXObject(activeXDetectRules[i].name);
if(typeof obj == "object"){
self.installed = true;
version = activeXDetectRules[i].version(obj);
if(version!=-1){
var versionObj = parseActiveXVersion(version);
self.major = versionObj.major;
self.minor = versionObj.minor;
self.revision = versionObj.revision;
self.revisionStr = versionObj.revisionStr;
self.activeXVersion = version;
}
}
}
}
}();
};
var versionFlash = FlashDetect.major;
var revisionFlash = FlashDetect.revisionStr;
var subVersionFlash = revisionFlash.replace(/[^\d]+/g, "");
function EPET_FlashHTML(minVersion, source, width, height, op, id){
var self = this;
var baseElement = document.createElement("div");
var options = arguments[4] || {};
var winIE = ((navigator.appVersion.toLowerCase().indexOf("win")!=-1) && (navigator.appName=="Microsoft Internet Explorer"));
var idCount = EPET_FlashHTML.idCount++;
var namespaceAdded = false;
var namespaceName = "flashtml";
var namespaceURN = "http://www.featureblend.com/2007/flashtml/";
if (typeof(id) == "undefined" )
var id = "objetoFlash" + String(Math.random()).substr(2,9);
var idObjeto = id;
self.domTemplate = "";
self.innerHTML = "";
self.xhtml = "";
self.inDocumentElement = "";
var getCabVersion = function(minVersion){
return minVersion + ",0,0,0";
};
var getNameValueAttrFromOptions = function(name){
return (typeof options[name] != "undefined")?getNameValueAttributes(name, options[name].toString()):"";
};
var getNameValueAttributes = function(name, value){
return {
"@name":name,
"@value":value
};
};
var createElementFromRule = function(name, target){
var newElement = safeCreateElement(name.replace("#",""));
return target.appendChild(newElement);
};
var getID = function(){
if (idObjeto != undefined && idObjeto != "")
return idObjeto;
var patron = /.*\/([\w-]+)\.swf\??/i;
if (patron.test(source))
{
return (RegExp.$1);
}
return "ObjetoSWF";
};
var setAttributeFromRule = function(name, value, target){
target.setAttribute(name.replace("@",""), value);
};
var safeCreateElement = function(name){
if((name=="object" || name=="param") && document.namespaces){
if(!namespaceAdded){
document.namespaces.add(namespaceName, namespaceURN);
namespaceAdded = true;
}
return document.createElement(namespaceName + ":" + name);
}else{
return document.createElement(name);
}
};
var htmlTidy = function(str){
str = str.replace(/<\?xml([^>]*)>/, "");
str = str.replace(eval("/"+namespaceName+":/g"),"");
str = str.replace(/><\/param>/g,">");
str = str.replace(/(<param )(.*?)(>)/g, "<param $2 \/>");
return str;
};
var parseRules = function(position, target){
for(var i in position){
if(i.charAt(0)=="#"){
var appendedElement;
if(typeof position[i] == "object" && position[i].length){
for(var j=0; j<position[i].length; j++){
if(position[i][j]()!==""){
appendedElement = createElementFromRule(i, target);
parseRules(position[i][j](), appendedElement);
}
}
}else if(typeof position[i]=="function" && position[i]()!==""){
appendedElement = createElementFromRule(i, target);
parseRules(position[i](), appendedElement);
}
}else if(i.charAt(0)=="@"){
if(typeof position[i]=="function" && position[i]()!==""){
setAttributeFromRule(i, position[i](), target);
}else if(typeof position[i] == "string"){
setAttributeFromRule(i, position[i], target);
}
}
}
};
var structuralRules = {
"#object":function(){
return {
"@type":function(){
return (!winIE)?"application/x-shockwave-flash":"";
},
"@codebase":function(){
return (winIE)?"http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab#version="+getCabVersion(minVersion):"";
},
"@classid":function(){
return (winIE)?"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000":"";
},
"@data":function(){
return (!winIE)?source:"";
},
"@width":function(){
return width.toString();
},
"@height":function(){
return height.toString();
},
"@id":function(){
return getID();
},
"@tabindex":function(){
return options.tabindex || "";
},
"#param":[
function(){
return (winIE)?getNameValueAttributes("movie", source):"";
},
function(){
return getNameValueAttrFromOptions("allowscriptaccess");
},
function(){
return getNameValueAttrFromOptions("allowfullscreen");
},
function(){
return getNameValueAttrFromOptions("swliveconnect");
},
function(){
return getNameValueAttrFromOptions("play");
},
function(){
return getNameValueAttrFromOptions("loop");
},
function(){
return getNameValueAttrFromOptions("menu");
},
function(){
return getNameValueAttrFromOptions("quality");
},
function(){
return getNameValueAttrFromOptions("scale");
},
function(){
return getNameValueAttrFromOptions("align");
},
function(){
return getNameValueAttrFromOptions("salign");
},
function(){
return getNameValueAttrFromOptions("wmode");
},
function(){
return getNameValueAttrFromOptions("bgcolor");
},
function(){
return getNameValueAttrFromOptions("base");
},
function(){
var result = "";
if(options.flashvars){
var flashVarsStr = (typeof options.flashvars == "object")?EPET_FlashHTML.getQueryStrFromObj(options.flashvars):options.flashvars;
result = getNameValueAttributes("flashvars", flashVarsStr);
}
return result;
}
]
};
}
};
self.append = function(target){
return addToElement(target, false);
};
self.replace = function(target){
return addToElement(target, true);
};
var addToElement = function(target, replace){
var result = false;
var targetObj = (typeof target=="object")?target:document.getElementById(target);
if(!self.inDocumentElement){
if(winIE){
if(replace){
targetObj.innerHTML = self.xhtml;
}else{
targetObj.innerHTML += self.xhtml;
}
self.inDocumentElement = document.getElementById(getID());
window.attachEvent("onunload", self.garbageCollection);
}else{
if(replace){
while (targetObj.firstChild) {
targetObj.removeChild(targetObj.firstChild);
}
}
self.inDocumentElement = targetObj.appendChild(baseElement.childNodes[0]);
}
result = self.inDocumentElement;
}
return result;
};
self.garbageCollection = function(){
if(winIE && self.inDocumentElement){
self.inDocumentElement = null;
}
};
self.EPET_FlashHTML = function(){
parseRules(structuralRules, baseElement);
self.domTemplate = baseElement.childNodes[0];
self.innerHTML = baseElement.innerHTML;
self.xhtml = htmlTidy(self.innerHTML);
}();
self.writeHTML = function(){
document.write(self.xhtml);
};
}
EPET_FlashHTML.getQueryStrFromObj = function(nameValue){
var str = "";
for(var i in nameValue){
if(nameValue.hasOwnProperty(i)){
str += (encodeURI(i) + "=" + encodeURI(nameValue[i]) + "&");
}
}
return str.substring(0, str.length-1);
};
EPET_FlashHTML.idCount = 0;
EPET_FlashHTML.idPattern = "EPET_FlashHTML_";
EPET_FlashHTML.release = "1.0.1";
function EPET_Grafico_Flash(grafico, GF_version, GF_params, flash_params, GF_width, GF_height, img_altenativa, url_alternativa, texto_alt, idDivContenedor, idObjectFlash)
{
var id_div_Graficoflash;
if (typeof(idDivContenedor) == "undefined" )
{
id_div_Graficoflash =  "div_GraficoFlash_" + String(Math.random()).substr(2,9);
document.write('<div id="' + id_div_Graficoflash + '"></div>');
}
else
id_div_Graficoflash = idDivContenedor;
if (versionFlash >= GF_version)
{
var params = {"menu":"false", "wmode":"window" };
for(var key in flash_params)
{
params[key] = flash_params[key];
}
var cadena_params = "";
for(var key in GF_params)
{
cadena_params += encodeURIComponent(key) + "=" + encodeURIComponent(GF_params[key]) + "&";
}
if (cadena_params.length > 0)
grafico = grafico + "?" + cadena_params.substr(0,cadena_params.length-1);
var objeto_grafico = new EPET_FlashHTML(GF_version, grafico, GF_width, GF_height, params , idObjectFlash);
objeto_grafico.replace(id_div_Graficoflash);
}
else
{
if (img_altenativa != "")
{
document.getElementById(id_div_Graficoflash).innerHTML = "<a href=\"" + url_alternativa + "\" target=\"_blank\" ><img src=\"" + img_altenativa + "\" width=\"" + GF_width + "\" height=\"" + GF_height + "\" border=\"0\"  alt=\"" + texto_alt + "\" /></a>\n";
}
}
}
function marcadoEventos(obj)
{
if (!obj.datos.myStreamingTag || typeof(iniciaMarcadoComscore) == "undefined")
return;
switch (obj.evento){
case "adStart": case "mediaBegin":
case "adResumed": case "mediaResumed":
if (obj.evento == "adStart" || obj.evento == "adResumed")
obj.datos.time = obj.datos.adCurrentTime ? obj.datos.adCurrentTime : 0;
else
obj.datos.time = obj.datos.currentTime ? obj.datos.currentTime : 0;
iniciaMarcadoComscore(obj);
obj.datos.estadoComscore = obj.evento;
break;
case "adComplete": case "mediaComplete":
case "adPaused": case "adSkip": case "mediaPaused":
if (obj.datos.estadoComscore == "adPaused" || obj.datos.estadoComscore == "mediaPaused" )
return;
if (obj.evento == "adComplete" || obj.evento == "adPaused" || obj.evento == "adSkip")
obj.datos.time = obj.datos.adCurrentTime ? obj.datos.adCurrentTime : 0;
else
obj.datos.time = obj.datos.currentTime ? obj.datos.currentTime : 0;
paraMarcadoComscore(obj);
obj.datos.estadoComscore = obj.evento;
break;
default:
break;
}
}
var EPET_Marcado_Multimedia = function(datosMarcado)
{
this._datosMarcado = datosMarcado;
this.eventos = {};
this._datosMarcado.estadoComscore = "";
var evars = '70|8|2|74|42|67|24';
this.marcaEvento = function(evento)
{
var event = "";
var key = evento;
switch (evento)
{
case "adStart" :
event = "event13";
key = evento + " _" + this._datosMarcado.adCue;
marcadoEventos({"datos":this._datosMarcado,"evento": evento});
break;
case "adComplete" :
event = "event14";
key = evento + " _" + this._datosMarcado.adCue;
marcadoEventos({"datos":this._datosMarcado,"evento": evento});
break;
case "adSkip" :
event = "event15";
key = evento + " _" + this._datosMarcado.adCue;
marcadoEventos({"datos":this._datosMarcado,"evento": evento});
break;
case "adError" :
event = "event18";
key = evento + " _" + this._datosMarcado.adCue;
break;
case "mediaBegin" :
event = "event11";
marcadoEventos({"datos":this._datosMarcado,"evento": evento});
break;
case "mediaComplete" :
event = "event12";
marcadoEventos({"datos":this._datosMarcado,"evento": evento});
break;
case "halfmediaComplete" :
event = "event79";
break;
case "adRequest" :
event = "event59";
key = evento + " _" + this._datosMarcado.adCue;
break;

case "adPaused" :
case "mediaPaused" :
marcadoEventos({"datos":this._datosMarcado,"evento": evento});
break;
case "adResumed" :
marcadoEventos({"datos":this._datosMarcado,"evento": evento});
break;
case "mediaResumed" :
marcadoEventos({"datos":this._datosMarcado,"evento": evento});
break;
default :
break;
}
if (this.eventos[key])
return;
this.eventos[key] = 1;
if (event != "")
{
var evars_value = this._datosMarcado.media + "|" + this._datosMarcado.titulo.replace(/'|"|\|/g, "") + " - " + this._datosMarcado.referencia + "|" + (this._datosMarcado.playerName ? this._datosMarcado.playerName.replace(/'|"|\|/g, ""):"") + "|" + Math.floor(this._datosMarcado.duracion) + "|" + this._datosMarcado.tipoReproduccion + "|" + this._datosMarcado.publicidad + (this._datosMarcado.ad != "" ? " " + this._datosMarcado.ad : "" ) + "|" + this._datosMarcado.adCue;
var newevars = evars;
if (typeof(this._datosMarcado.adTitle) != "undefined" && this._datosMarcado.adTitle != "")
{
newevars = newevars + "|9";
evars_value += "|" + this._datosMarcado.adTitle;
}
if (typeof(this._datosMarcado.posSiguientesVideos) != "undefined")
{
newevars = newevars + "|76";
evars_value += "|" + this._datosMarcado.posSiguientesVideos;
}
if (typeof(this._datosMarcado.uid) != "undefined" && this._datosMarcado.uid != "")
{
newevars = newevars + "|38";
evars_value += "|" + this._datosMarcado.uid;
}
newevars = newevars + "|25";
evars_value += "|" + (this._datosMarcado.fuente ? this._datosMarcado.fuente : "propio");
if (typeof(this._datosMarcado.seccion_creacion) != "undefined" && this._datosMarcado.seccion_creacion != "")
{
newevars = newevars + "|77";
evars_value += "|" + this._datosMarcado.seccion_creacion;
}
if (typeof(this._datosMarcado.modoReproduccion) != "undefined" && this._datosMarcado.modoReproduccion != "")
{
newevars = newevars + "|26";
evars_value += "|" + this._datosMarcado.modoReproduccion;
}
if (typeof(launchAjaxOMN) == "function")
launchAjaxOMN(newevars, evars_value, event,this._datosMarcado.tags, this._datosMarcado.autores);
}
}
this.marcaComscore = function(evento)
{
if (evento == "play" && typeof(this.eventos["mediaBegin"]) != "undefined")
{
marcadoEventos({"datos":this._datosMarcado,"evento": "mediaResumed"});
}
else
if (evento == "adPaused" || evento == "pause")
{
marcadoEventos({"datos":this._datosMarcado,"evento": evento == "adPaused" ? "adPaused" : "mediaPaused"});
}
else
if (evento == "adResumed" )
{
marcadoEventos({"datos":this._datosMarcado,"evento": evento});
}
}
}
function marcadoReproductorMultimedia(datos)
{
var objetoVideo = MultimediaPEP[datos.id].multimedia;
datos.uid = objetoVideo.uid();
datos.seccion_creacion = objetoVideo.seccion_creacion();
datos.fuente = objetoVideo.fuente();
datos.tags = objetoVideo.tags();
datos.autores = objetoVideo.autores();
objetoVideo.marcado(datos);
}
var videoFlash =  versionFlash > 11 || (versionFlash == 11 && FlashDetect.minor >= 1);
if (dispositivoMovil && (userAgent.indexOf("firefox") > -1 || userAgent.indexOf("android 2") > -1))
publicidad_HTML5 = false;
var reproduciendo = false;
var MultimediaActual = "";
var MultimediaPEP = {};
var id_pidiendoDatos  = "";
var contadorMultimedia = 0;
function soporteVideo()
{
var v=document.createElement('video');
return typeof(v.canPlayType) != "undefined" && (!!v.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"').replace(/no/,'') || !!v.canPlayType( 'video/mp4; codecs="avc1.42E01E"').replace(/no/,''));
}
var canPlayMP4 = soporteVideo();
var canPlayHLS = (window.MediaSource && window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'));
function EPETaddEvent (element, evento, func) {
if (document.addEventListener){
element.addEventListener(evento, func, false);
} else {
element.attachEvent('on'+evento, func);
}
}
function EPETremoveEvent(element, evento, func)
{
if (document.removeEventListener)
element.removeEventListener(evento, func)
else
if (document.detachEvent)
element.detachEvent('on'+evento, func);
}
function EPET_setScrollPosition(val)
{
if (document.documentElement.scrollTop)
document.documentElement.scrollTop  = val
else
window.scrollTo(0,val);
}
function EPET_calculaTopPosition(obj)
{
var curTop = 0;
if (obj.offsetParent) {
do {
curTop += obj.offsetTop;
} while (obj = obj.offsetParent);
}
return curTop;
}
function VideoReproduciendo(id, play)
{
MultimediaReproduciendo(id, play)
}
function MultimediaReproduciendo(id, play)
{
if ( MultimediaActual != "" && id != MultimediaActual)
{
MultimediaPEP[MultimediaActual].multimedia.pause();
var datos;
var newid = MultimediaPEP[MultimediaActual].id;
if (MultimediaPEP[MultimediaActual].modoSiguientesVideos == 0)
{
datos = MultimediaPEP[MultimediaActual].datos;
datos.autoplay = false;
delete MultimediaPEP[MultimediaActual];
setTimeout(function(){
document.getElementById(newid).innerHTML = "";
EPET_VideoPlayer(datos, newid);
},500);
}
else {
if (MultimediaPEP[MultimediaActual].id != MultimediaPEP[id].id) {
resetSiguientesVideos();
clearTimeout(SiguientesVideosPEP.cuenta_atras);
datos = JSON.parse(JSON.stringify(MultimediaPEP_originales[MultimediaPEP[MultimediaActual].id]));
document.getElementById(MultimediaPEP[MultimediaActual].id).style.paddingTop = '0px';
document.getElementById(MultimediaPEP[MultimediaActual].id).style.marginLeft = '0px';
delete MultimediaPEP[MultimediaActual];
datos.autoplay = false;
setTimeout(function(){
document.getElementById(newid).innerHTML = "";
var video = new EPET_Video(datos, newid);
},500);
}
}
if (play)
setTimeout(function() {	MultimediaPEP[id].multimedia.play();}, 300);
}
MultimediaActual = id;
}
function MultimediaReinicio(id)
{
MultimediaPEP[id].multimedia.resetMarcado(id);
}
function MultimediaSeeking(id)
{
MultimediaPEP[id].multimedia.seeking();
}
function MultimediaSeeked(id)
{
MultimediaPEP[id].multimedia.seeked();
}
function reseteaVideo(datosVideo, id_div_ReproductorVideo,id)
{
MultimediaPEP[id].multimedia.stop();
}
var MultimediaPEP_originales = {};
var SiguientesVideosPEP = {};
SiguientesVideosPEP.dataSources = {};
SiguientesVideosPEP.source_active = "";
SiguientesVideosPEP.ref_active = "";
SiguientesVideosPEP.id_ref_active = "";
SiguientesVideosPEP.videoWallData = null;
SiguientesVideosPEP.videoWall_primera_vez = false;
SiguientesVideosPEP._id = "";
SiguientesVideosPEP._datos = "";
SiguientesVideosPEP.cuenta_atras = null;
SiguientesVideosPEP.cuenta_atras_error = null;
SiguientesVideosPEP.segundos = modoSiguientesVideosTimeout;
SiguientesVideosPEP.keyword_primero = "user_initiated";
SiguientesVideosPEP.keyword_siguientes = "auto_initiated";
SiguientesVideosPEP.fuente_unica = 'videos_destacados';
SiguientesVideosPEP.id_fuente_unica = '200000';
SiguientesVideosPEP.paraBorrar = [];
SiguientesVideosPEP.template = '<div class="MPEP-principal MPEP-estirar #classmin#"><div class="MPEP-prox-video MPEP-estirar">'+
'<div class="MPEP-inner MPEP-estirar">'+
'<div class="MPEP-prox-btn-ctrl MPEP-estirar">'+
'<a class="MPEP-prox-btn-ant" href="javascript:void(0)" onclick="javascript:volver_a_ver()"><span>Volver a ver</span></a>'+
'<a class="MPEP-prox-btn-sig" href="javascript:void(0)" onclick="javascript:cargaVideo(false,\'organico\')"><span>Siguiente</span></a>'+
'</div>'+
'<span class="MPEP-prox-cont">Siguiente vídeo en <strong id="siguientes_contador">5</strong> segundos</span>'+
'<div class="MPEP-prox-video-media"><a href="javascript:void(0)" onclick="javascript:cargaVideo(false,\'organico\')"><img class="MPEP-prox-video-img" src="#foto#" alt="" /></a></div>'+
'<div class="MPEP-prox-video-txt">'+
'<div class="MPEP-prox-tit"><a href="javascript:void(0)" onclick="javascript:cargaVideo(false,\'organico\')">#titulo#</a></div>'+
'</div>'+
'</div>'+
'</div>'+
'</div></div>';
SiguientesVideosPEP.video = "";
SiguientesVideosPEP.primeraVez = false;
function siguientesVideos(fuente, referencia)
{
var id_contenedor = MultimediaPEP[referencia].id;
SiguientesVideosPEP.source_active = fuente;
SiguientesVideosPEP.ref_active = referencia;
SiguientesVideosPEP.id_ref_active = id_contenedor;
SiguientesVideosPEP.primeraVez = false;
if (typeof(SiguientesVideosPEP.dataSources[fuente]) != "undefined")
{
videosSiguientes_callback(SiguientesVideosPEP.dataSources[fuente].datos)
}
else
{
var head = document.getElementsByTagName("head")[0];
var script = document.createElement("script");
script.type = "text/javascript";
script.src = "//ep00.epimg.net/rss/tags/continuo/c_" + fuente + ".js2";
head.appendChild(script);
SiguientesVideosPEP.primeraVez = true;
}
}
function barajaArray(ref) {
var salida = new Array;
var copia = JSON.parse(JSON.stringify(ref));
while (copia.length > 0)
{
salida.push(copia.splice(Math.floor(Math.random() * copia.length),1)[0]);
}
return salida;
}
function videosSiguientes_callback(datos)
{
if (!SiguientesVideosPEP.dataSources[SiguientesVideosPEP.source_active])
{
SiguientesVideosPEP.dataSources[SiguientesVideosPEP.source_active] = {};
SiguientesVideosPEP.dataSources[SiguientesVideosPEP.source_active].datos = datos;
}
if (SiguientesVideosPEP.videoWallData == null)
{
if (SiguientesVideosPEP.primeraVez)
SiguientesVideosPEP.videoWallData = JSON.parse(JSON.stringify(SiguientesVideosPEP.dataSources[SiguientesVideosPEP.source_active].datos));
else
SiguientesVideosPEP.videoWallData = barajaArray(SiguientesVideosPEP.dataSources[SiguientesVideosPEP.source_active].datos);
SiguientesVideosPEP.videoWallData.unshift(JSON.parse(JSON.stringify(MultimediaPEP_originales[SiguientesVideosPEP.id_ref_active])));
}
if (!SiguientesVideosPEP.dataSources[SiguientesVideosPEP.source_active][SiguientesVideosPEP.id_ref_active])
{
SiguientesVideosPEP.dataSources[SiguientesVideosPEP.source_active][SiguientesVideosPEP.id_ref_active] = {};
SiguientesVideosPEP.dataSources[SiguientesVideosPEP.source_active][SiguientesVideosPEP.id_ref_active].idx = 1;
SiguientesVideosPEP.dataSources[SiguientesVideosPEP.source_active][SiguientesVideosPEP.id_ref_active].ancho = MultimediaPEP[SiguientesVideosPEP.ref_active].datos.anchoPlayer;
SiguientesVideosPEP.dataSources[SiguientesVideosPEP.source_active][SiguientesVideosPEP.id_ref_active].alto = MultimediaPEP[SiguientesVideosPEP.ref_active].datos.altoPlayer;
SiguientesVideosPEP.dataSources[SiguientesVideosPEP.source_active][SiguientesVideosPEP.id_ref_active].source = SiguientesVideosPEP.source_active;
}
else
{
SiguientesVideosPEP.dataSources[SiguientesVideosPEP.source_active][SiguientesVideosPEP.id_ref_active].idx += 1;
}
cargaSiguienteVideo(SiguientesVideosPEP.dataSources[SiguientesVideosPEP.source_active], SiguientesVideosPEP.ref_active)
}
function reajustaDimensiones(cajaw, cajah, videow, videoh)
{
var salida = [0,0,0,0];
var prop1 = cajaw * videoh / videow;
if ( prop1 > cajah)
{
salida[1] = cajah;
salida[0] = Math.floor(cajah * videow / videoh);
salida[2] = Math.round((cajaw - salida[0]) / 2);
}
else
{
salida[0] = cajaw;
salida[1] = Math.floor(prop1);
salida[3] = Math.round((cajah - salida[1]) /2);
}
return salida;
}
function cargaSiguienteVideo(ref_datos, id_actual)
{
var id_video = id_actual.replace(/\-\d+$/, "");
SiguientesVideosPEP._id = MultimediaPEP[id_actual].id;
var dims;
cargaVideo = function(pause, modo) {
clearTimeout(SiguientesVideosPEP.cuenta_atras);
MultimediaActual = id_actual;
if (!dispositivoMovil && !pause)
SiguientesVideosPEP._datos.autoplay = true;
else
SiguientesVideosPEP._datos.autoplay = false;
document.getElementById(SiguientesVideosPEP._id).innerHTML = "";
if (typeof(modo) == "undefined")
SiguientesVideosPEP._datos.modoReproduccion = "secuencial";
else
SiguientesVideosPEP._datos.modoReproduccion = modo;
SiguientesVideosPEP.video = new EPET_Video(SiguientesVideosPEP._datos, SiguientesVideosPEP._id, true);
};
if (!SiguientesVideosPEP.videoWall_primera_vez)
{
SiguientesVideosPEP.videoWall_primera_vez = true;
for (var n=SiguientesVideosPEP.paraBorrar.length-1; n>=0; n--)
{
var id = SiguientesVideosPEP.paraBorrar.splice(i,1);
delete(MultimediaPEP[id[0]]);
}
for (var i = SiguientesVideosPEP.videoWallData.length - 1; i >= 0; i--)
{
dims = reajustaDimensiones(ref_datos[SiguientesVideosPEP._id].ancho, ref_datos[SiguientesVideosPEP._id].alto, SiguientesVideosPEP.videoWallData[i].anchoPlayer, SiguientesVideosPEP.videoWallData[i].altoPlayer);
if ((i > 0 && (SiguientesVideosPEP.videoWallData[i].idRefBrightcove + UN) == id_video) || dims[2] > 20 || dims[3] > 20)
{
SiguientesVideosPEP.videoWallData.splice(i,1);
continue;
}
SiguientesVideosPEP.videoWallData[i].anchoPlayer = dims[0];
SiguientesVideosPEP.videoWallData[i].altoPlayer = dims[1];
SiguientesVideosPEP.videoWallData[i].anchoFotograma = dims[0];
SiguientesVideosPEP.videoWallData[i].altoFotograma = dims[1];
SiguientesVideosPEP.videoWallData[i].playerEPETParams.mediaWidth = dims[0];
SiguientesVideosPEP.videoWallData[i].playerEPETParams.mediaHeight = dims[1];
SiguientesVideosPEP.videoWallData[i].ancho_caja = ref_datos[SiguientesVideosPEP._id].ancho;
SiguientesVideosPEP.videoWallData[i].alto_caja = ref_datos[SiguientesVideosPEP._id].alto;
SiguientesVideosPEP.videoWallData[i].left = dims[2];
SiguientesVideosPEP.videoWallData[i].top = dims[3];
SiguientesVideosPEP.videoWallData[i].agrsNombreNormalizado = SiguientesVideosPEP.fuente_unica;
SiguientesVideosPEP.videoWallData[i].agrsIds = SiguientesVideosPEP.id_fuente_unica;
SiguientesVideosPEP.videoWallData[i].autoplay = dispositivoMovil ? false : true;
SiguientesVideosPEP.videoWallData[i].idx_siguientes_videos = i;
}
}
var idx = ref_datos[SiguientesVideosPEP._id].idx;
if (idx >= SiguientesVideosPEP.videoWallData.length)
{
clearTimeout(SiguientesVideosPEP.cuenta_atras);
SiguientesVideosPEP._datos = SiguientesVideosPEP.videoWallData[0];
cargaVideo(true);
resetSiguientesVideos();
return;
}
var cuenta = SiguientesVideosPEP.segundos;
cuentaAtras = function ()
{
if (cuenta > 0)
{
if (!document.getElementById("siguientes_contador"))
return;
document.getElementById("siguientes_contador").innerHTML = cuenta;
cuenta--;
SiguientesVideosPEP.cuenta_atras = setTimeout('cuentaAtras()',1000);
}
else
{
cargaVideo();
}
};
volver_a_ver = function()
{
clearTimeout(SiguientesVideosPEP.cuenta_atras);
ref_datos[SiguientesVideosPEP._id].idx -= 1;
SiguientesVideosPEP._datos = JSON.parse(JSON.stringify(SiguientesVideosPEP.videoWallData[ref_datos[SiguientesVideosPEP._id].idx]));
cargaVideo(false,'organico');
if (SiguientesVideosPEP.video.tipo() == "html5" && SiguientesVideosPEP._datos.autoplay )
SiguientesVideosPEP.video.play();
};
SiguientesVideosPEP._datos = JSON.parse(JSON.stringify(SiguientesVideosPEP.videoWallData[ref_datos[SiguientesVideosPEP._id].idx]));
var codigo = SiguientesVideosPEP.template.replace("#titulo#", SiguientesVideosPEP._datos.tituloVideo.replace('"',''));
codigo = codigo.replace("#foto#",SiguientesVideosPEP._datos.playerEPETParams.URLMediaStill);
if (SiguientesVideosPEP._datos.ancho_caja < 420)
{
codigo = codigo.replace('#classmin#','MPEP-420');
}
else
{
codigo = codigo.replace('#classmin#','');
}
document.getElementById(SiguientesVideosPEP._id).style.paddingTop = "0px";
document.getElementById(SiguientesVideosPEP._id).style.marginLeft = "0px";
document.getElementById(SiguientesVideosPEP._id).innerHTML = codigo;
document.getElementById(SiguientesVideosPEP._id).style.marginLeft = "auto";
document.getElementById(SiguientesVideosPEP._id).style.marginRight = "auto";
cuentaAtras();
}
function resetSiguientesVideos()
{
SiguientesVideosPEP.videoWallData = null;
SiguientesVideosPEP.videoWall_primera_vez = false;
if (typeof(SiguientesVideosPEP.dataSources[SiguientesVideosPEP.source_active]) != "undefined" && typeof(SiguientesVideosPEP.dataSources[SiguientesVideosPEP.source_active][SiguientesVideosPEP.id_ref_active]) != "undefined")
delete(SiguientesVideosPEP.dataSources[SiguientesVideosPEP.source_active][SiguientesVideosPEP.id_ref_active]);
}
function EPET_PlayerRetransmisionDirecto(datosTransmision, id_divContenedor, estado)
{
url_reproductor_epet = url_reproductor_epet_live;
if (typeof(retransmisiones) != "undefined" && typeof(retransmisiones[datosTransmision.refRetransmisionBC]) != "undefined")
datosTransmision.refRetransmisionBC = retransmisiones[datosTransmision.refRetransmisionBC];
var id_div_ReproductorVideo;
if (typeof(id_divContenedor) == "undefined" )
{
id_div_ReproductorVideo = "VideoPlayer_Directo_" + String(Math.random()).substr(2,9);
document.write('<div id="' + id_div_ReproductorVideo + '"></div>');
}
else
id_div_ReproductorVideo = id_divContenedor;
if (typeof(estado) == "undefined" || estado == "" || estado == 0)
estado = "0";
if (estado != "0")
retransmisionBloqueada(datosTransmision, id_div_ReproductorVideo, estado);
else
{
if (typeof(datosTransmision.transmision_m3u8 != "undefined") && datosTransmision.transmision_m3u8 != "")
{
EPETUtils_makeHttpRequestGet(function(e){
if (e.status == 200)
{
datosVideo = {};
datosVideo.playerEPETParams = {"mediaWidth":datosTransmision.ancho, "mediaHeight":datosTransmision.alto, "URLMediaFile":"", "URLMediaStill":datosTransmision.caratula, "URLFirstFrame":"", "compactMode": 'false'};
datosVideo.anchoPlayer = datosTransmision.ancho;
datosVideo.altoPlayer = datosTransmision.alto;
datosVideo.id_referencia = datosTransmision.refRetransmisionBC;
datosVideo.caratula = datosTransmision.caratula;
datosVideo.publiActiva = datosTransmision.publicidad;
datosVideo.keywordsVideo = datosTransmision.keywords;
if (typeof(datosTransmision.mute) != "undefined")
datosVideo.mute = datosTransmision.mute;
if (datosTransmision.refRetransmisionBC.indexOf("akamai_001") > -1 || datosTransmision.refRetransmisionBC.indexOf("akamaihls_001") > -1 ||
datosTransmision.refRetransmisionBC.indexOf("akamai_002") > -1 || datosTransmision.refRetransmisionBC.indexOf("akamaihls_003") > -1 ||
datosTransmision.refRetransmisionBC.indexOf("level3_001") > -1 || datosTransmision.refRetransmisionBC.indexOf("level3hls_001") > -1)
{
if (datosVideo.keywordsVideo == "")
datosVideo.keywordsVideo = "overon_stream";
else
datosVideo.keywordsVideo += ",overon_stream";
}
datosVideo.urlNoticia = document.location.href;
datosVideo.tituloVideo = PAGE_TITLE;
datosVideo.tipoReproduccion = "streaming";
datosVideo.m3u8 = datosTransmision.transmision_m3u8;
modoSiguientesVideos = 0;
if (typeof(datosTransmision.autoplay) != "undefined")
datosVideo.autoplay = datosTransmision.autoplay;
if (document.location.href.indexOf("autoplay=1") > -1 && !reproduciendo)
{
reproduciendo = true;
datosVideo.autoplay = true;
}
if (MPEP_responsive)
setTimeout(function(){var video = new EPET_Video(datosVideo, id_div_ReproductorVideo);}, 300);
else
var video = new EPET_Video(datosVideo, id_div_ReproductorVideo);
}
else
{
retransmisionBloqueada(datosTransmision, id_div_ReproductorVideo, "4");
}
}, datosTransmision.transmision_m3u8);
}
}
}
function retransmisionBloqueada(datosTransmision, id_div_ReproductorVideo, estado)
{
var texto_error = "";
switch(String(estado))
{
case "1":
texto_error =  LANG_MSG[LANG].trans_no_comenzado;
break;
case "2":
texto_error = LANG_MSG[LANG].trans_reanudara;
break;
case "3":
texto_error =  LANG_MSG[LANG].trans_finalizada;
break;
case "4":
texto_error =  LANG_MSG[LANG].trans_no_activa;
break;
default:
texto_error = "";
}
var an = datosTransmision.ancho;
var al = datosTransmision.alto;
if ( !css_multimedia_cargado)
{
css_multimedia_cargado = true;
loadCSS(css_multimedia,null,false)
}
if (versionMovil || MPEP_responsive)
{
an = "100%";
al = "auto";
}
document.getElementById(id_div_ReproductorVideo).onclick = null;
document.getElementById(id_div_ReproductorVideo).innerHTML = '<div class="video_previa video_no_disponible"><div class="fondo_mensaje_video" ><span>' + texto_error +
'</span></div><img src="' + datosTransmision.caratula + '" width="' +  an + '" height="' + al + '"/></div>';
}
var CACHE_VDPEP={};
function pideDatosVideo(id_video)
{
id_pidiendoDatos = id_video;
var id_servidor = id_video.replace(/\-\d+$/, "");
if (typeof(CACHE_VDPEP[id_servidor]) != "undefined")
{
EPET_VideoPlayer_callback(CACHE_VDPEP[id_servidor]);
return;
}
var url = "//elpais.com/vdpep/1/?pepid=";
var head = document.getElementsByTagName("head")[0];
if (!MultimediaPEP[id_video])
MultimediaPEP[id_video] = new Object;
if( MultimediaPEP[id_video].script){
head.removeChild(MultimediaPEP[id_video].script);
}
MultimediaPEP[id_video].script = document.createElement("script");
MultimediaPEP[id_video].script.type = "text/javascript";
MultimediaPEP[id_video].script.src = url + id_servidor;
head.appendChild(MultimediaPEP[id_video].script);
}
function EPET_VideoPlayer_callback(datos)
{
var id_servidor = id_pidiendoDatos.replace(/\-\d+$/, "");
if (typeof(CACHE_VDPEP[id_servidor]) == "undefined")
{
CACHE_VDPEP[id_servidor] = datos;
}
MultimediaPEP[id_pidiendoDatos].multimedia.cargaDatos(datos);
}
function EPET_VideoPlayer (datosVideo, idDivContenedor)
{
var id_div_ReproductorVideo;
if (typeof(idDivContenedor) == "undefined" )
{
id_div_ReproductorVideo = "VideoPlayer_" + String(Math.random()).substr(2,9);
document.write('<div id="' + id_div_ReproductorVideo + '"></div>');
}
else
id_div_ReproductorVideo = idDivContenedor;
if ((typeof(datosVideo.idRefBrightcove) == "undefined"  || datosVideo.idRefBrightcove == "") && typeof(datosVideo.playerEPETParams.URLMediaFile) != "undefined")
{
var re = /\/([\w\d_]+)\.mp4$/;
var result = re.exec(datosVideo.playerEPETParams.URLMediaFile);
if (result)
{
datosVideo.idRefBrightcove = result[1];
}
}
var video = new EPET_Video(datosVideo, id_div_ReproductorVideo);
}
function PlayerMultimedia(datosMultimedia, divMultimedia)
{
var id_div_ReproductorMultimedia;
if (typeof(divMultimedia) == "undefined" )
{
id_div_ReproductorMultimedia = "multimediaPlayer_" + String(Math.random()).substr(2,9);
document.write('<div id="' + id_div_ReproductorMultimedia + '"></div>');
}
else
id_div_ReproductorMultimedia = divMultimedia;
switch(datosMultimedia.tipo)
{
case "video":
if (datosMultimedia.id_referencia)
datosMultimedia.idRefBrightcove = datosMultimedia.id_referencia;
if (datosMultimedia.id)
datosMultimedia.id_video = datosMultimedia.id;
if (datosMultimedia.player)
datosMultimedia.playerVideo = datosMultimedia.player;
if (datosMultimedia.titulo)
datosMultimedia.tituloVideo = datosMultimedia.titulo;
if (datosMultimedia.keywords)
datosMultimedia.keywordsVideo = datosMultimedia.keywords;
if (!datosMultimedia.playerEPETParams)
datosMultimedia.playerEPETParams = {"mediaWidth":datosMultimedia.anchoPlayer, "mediaHeight":datosMultimedia.altoPlayer, "URLMediaFile":"", "URLMediaStill":datosMultimedia.poster, "URLFirstFrame":"", "compactMode": 'false'};
var video = new EPET_Video(datosMultimedia, id_div_ReproductorMultimedia);
break;
case "audio":
if (datosMultimedia.id)
datosMultimedia.id_audio = datosMultimedia.id;
if (datosMultimedia.player)
datosMultimedia.playerAudio = datosMultimedia.player;
if (datosMultimedia.titulo)
datosMultimedia.tituloAudio = datosMultimedia.titulo;
if (datosMultimedia.keywords)
datosMultimedia.keywordsAudio = datosMultimedia.keywords;
var audio = new EPET_Audio(datosMultimedia, id_div_ReproductorMultimedia);
break;
case "externo":
var url = datosMultimedia.src;
if (datosMultimedia.src && datosMultimedia.src.substr(datosMultimedia.src.length -3,3) == "mp3")
{
datosMultimedia.id_audio = String(Math.random()).substr(2,9);
if (datosMultimedia.player)
datosMultimedia.playerAudio = datosMultimedia.player;
if (datosMultimedia.titulo)
datosMultimedia.tituloAudio = datosMultimedia.titulo;
if (datosMultimedia.keywords)
datosMultimedia.keywordsAudio = datosMultimedia.keywords;
var audio = new EPET_Audio(datosMultimedia, id_div_ReproductorMultimedia);
}
else
{
var url = eligeUrlenlace(datosMultimedia.urls);
if (url != "")
{
var iframe = document.createElement("iframe");
iframe.setAttribute("width",datosMultimedia.anchoPlayer);
iframe.setAttribute("height",datosMultimedia.altoPlayer);
iframe.setAttribute("scrolling", "no");
iframe.frameBorder = 0;
if (document.location.href.indexOf("autoplay=1") > -1 && !reproduciendo)
{
reproduciendo = true;
datosMultimedia.autoplay = true;
setTimeout(function(){
var posVideo = EPET_calculaTopPosition(document.getElementById(id_div_ReproductorMultimedia));
if (posVideo > dimensionesPEP.alto)
EPET_setScrollPosition(parseInt(posVideo) - 90);
},300);
}
if (datosMultimedia.autoplay)
{
if (url.match(/muzu/i))
{
url = url.replace(/&(amp;)?autostart=n/,"");
url += "&autostart=y";
}
else
if (url.match(/youtube/i))
url += "?autoplay=1";
}
if (url.match(/youtube/i))
{
if(url.indexOf('?') > -1)
url += "&wmode=transparent";
else
url += "?wmode=transparent";
}
iframe.src = url;
document.getElementById(id_div_ReproductorMultimedia).appendChild(iframe);
}
}
break;
default:
break;
}
}
var css_multimedia_cargado = false;
var EPET_Video = function(datosVideo,  idDivVideo, borrar)
{
this.objvideo = function()
{
return _datosVideo.nodoVideo;
}
this.cargaDatos = function(datos)
{
if (typeof(datos) == "undefined")
{
return;
}
if ((!datos.mp4 || datos.mp4.indexOf("http") != 0) && _datosVideo.playerEPETParams.URLMediaFile && _datosVideo.playerEPETParams.URLMediaFile != "")
{
datos.status = 100;
datos.mp4 = _datosVideo.playerEPETParams.URLMediaFile;
datos.ftgrm1 = _datosVideo.playerEPETParams.URLMediaStill;
}
if ( datos.status != 100)
{
EPET_VideoPlayerBloqueado(datos.id_video, _datosVideo.anchoPlayer, _datosVideo.altoPlayer, _datosVideo.playerEPETParams.URLMediaStill, datos.status, _idDivVideo);
if (_datosVideo.modoSiguientesVideos > 0 && SiguientesVideosPEP.videoWallData != null)
{
SiguientesVideosPEP.cuenta_atras_error = setTimeout(function(){
{
var canal = _datosVideo.agrsNombreNormalizado.split(",")[0];
siguientesVideos(canal, _datosVideo.id_video);
return;
}
},3000)}
return;
}
var cad_video = datos.mp4.replace(/^.*\//,"");
_datosVideo.playerEPETParams.URLMediaFile = (datos.mp4.indexOf('/') == 0 && datos.mp4.substr(0,2) != "//") ? _datosVideo.url_cache + datos.mp4 : datos.mp4;
_datosVideo.playerEPETParams.URLFirstFrame = (datos.ftgrm1.indexOf('/') == 0 && datos.ftgrm1.substr(0,2) != "//") ? _datosVideo.url_cache + datos.ftgrm1 : datos.ftgrm1;
_datosVideo.src = _datosVideo.playerEPETParams.URLMediaFile;
_datosVideo.poster = _datosVideo.playerEPETParams.URLFirstFrame;
_datosVideo.uid = datos.uid;
_datosVideo.seccion_creacion = _datosVideo.keywordsVideo ? _datosVideo.keywordsVideo.replace(/,?agencia_.*/,"") : datos.seccion_creacion;
_datosVideo.fuente = datos.fuente;
_datosVideo.duracion = typeof(datos.duracion) != "undefined" ? datos.duracion : 0;
if (datos.sprite && !_datosVideo.spriteImg)
{
_datosVideo.spriteImg = ( datos.sprite.indexOf('/') == 0 && datos.sprite.substr(0,2) != "//") ? _datosVideo.url_cache + datos.sprite :datos.sprite;
_datosVideo.nSprites = (datos.n_sprites) ? datos.n_sprites : 0;
}
if (_datosVideo.playerEPETParams.URLMediaFile.indexOf("rtmp") == 0)
_datosVideo.rtmpStream = datos.rtmpStream;
_datosVideo.urlNoticia = datos.url_noticia ? datos.url_noticia : document.location.pathname;
_datosVideo.tituloVideo = datos.titulo ? datos.titulo : PAGE_TITLE;
_datosVideo.tagsNombreNormalizado = datos.tags_names ? datos.tags_names : (typeof(listado_norm_tags) != "undefined" ? listado_norm_tags : "");
if (typeof(datos.tags_ids) != "undefined" && datos.tags_ids != "" )
_datosVideo.tagsIds = datos.tags_ids;
else
if (typeof(_datosVideo.tagsIds) == "undefined")
_datosVideo.tagsIds = "";
if (_datosVideo.agrsIds != undefined && _datosVideo.agrsIds != "")
{
if (_datosVideo.tagsIds != "")
_datosVideo.tagsIds += ',';
_datosVideo.tagsIds += _datosVideo.agrsIds;
}
_datosVideo.autoresIds = (typeof(datos.author_ids) != "undefined") ? datos.author_ids : "";
if (datos.hlsod)
_datosVideo.hlsod = (datos.hlsod.indexOf('/') == 0 && datos.hlsod.substr(0,2) != "//") ? _datosVideo.url_cache + datos.hlsod : datos.hlsod;
else
datos.hlsod = "";
_marcado._datosMarcado.myStreamingTag = null;
if (typeof(ns_) != "undefined" && typeof(id_comscore) != "undefined")
_marcado._datosMarcado.myStreamingTag = new ns_.StreamingTag({ customerC2: id_comscore });
if (_datosVideo._HTML5vsFLASH == "flash")
creaPlayerFlash();
else
{
_mainController.cargaDatos(_datosVideo);
}
}
this.play = function()
{
if (_datosVideo._HTML5vsFLASH == "flash")
{
if (document.getElementById(_idObjeto) && typeof(document.getElementById(_idObjeto).playjs) != "undefined")
{
document.getElementById(_idObjeto).playjs();
}
}
else
{
_datosVideo.nodoVideo.play();
}
MultimediaReproduciendo(_datosVideo.id_video, false);
}
this.pause = function()
{
if (_datosVideo._HTML5vsFLASH == "flash")
{
if (document.getElementById(_idObjeto) && typeof(document.getElementById(_idObjeto).pausejs) != "undefined")
document.getElementById(_idObjeto).pausejs();
}
else
{
if (isIpad)
{
if ( _mainController.adPlaying)
{
_mainController.restart();
_mainController.playerHTML5.adContainer.innerHTML = "";
_mainController.playerHTML5.controles.style.display = 'none';
_mainController.playerHTML5.adContainer.style.display = 'none';
}
}
if (_mainController)
_mainController.pause();
}
}
this.stop = function()
{
if (_datosVideo._HTML5vsFLASH == "html5")
{
_mainController.restart();
}
}
this.marcado = function(datos)
{
if (datos.duracion != undefined)
_marcado._datosMarcado.duracion = datos.duracion;
if (datos.playerName != undefined)
_marcado._datosMarcado.playerName = datos.playerName;
if (datos.ad != undefined)
_marcado._datosMarcado.ad = datos.ad;
if (datos.adCue != undefined)
_marcado._datosMarcado.adCue = datos.adCue;
if (datos.adTitle != undefined)
_marcado._datosMarcado.adTitle = datos.adTitle;
if (datos.uid != undefined)
_marcado._datosMarcado.uid = datos.uid;
if (datos.seccion_creacion != undefined)
_marcado._datosMarcado.seccion_creacion = datos.seccion_creacion;
if (datos.fuente != undefined)
_marcado._datosMarcado.fuente = datos.fuente;
if (datos.tags != undefined)
_marcado._datosMarcado.tags = datos.tags;
if (datos.autores != undefined)
_marcado._datosMarcado.autores = datos.autores;
if (datos.currentTime != undefined)
_marcado._datosMarcado.currentTime = datos.currentTime;
else
_marcado._datosMarcado.currentTime = -1;
if (datos.adCurrentTime != undefined)
_marcado._datosMarcado.adCurrentTime = datos.adCurrentTime;
else
_marcado._datosMarcado.adCurrentTime = -1;
if (datos.evento == "adStart" || datos.evento == "adComplete" || datos.evento == "adSkip" ||
datos.evento == "adError" || datos.evento == "mediaBegin" || datos.evento == "mediaComplete" ||
datos.evento == "halfmediaComplete" || datos.evento == "adRequest" ||
datos.evento == "adPaused" || datos.evento == "adResumed" ||
datos.evento == "mediaPaused" || datos.evento == "mediaResumed")
_marcado.marcaEvento(datos.evento);
}
this.seek = function(segundo)
{
if (_datosVideo._HTML5vsFLASH == "flash")
{
if (document.getElementById(_idObjeto))
{
document.getElementById(_idObjeto).seekjs(segundo);
}
}
else
{
if (_datosVideo._HTML5vsFLASH == "html5")
{
if (_mainController.adPlaying)
return;
_mainController.seekjs(segundo);
}
}
MultimediaReproduciendo(_datosVideo.id_video, false);
}
this.resetMarcado = function(id)
{
_marcado.eventos = {};
if (typeof(ns_) != "undefined" && typeof(id_comscore) != "undefined")
_marcado._datosMarcado.myStreamingTag = new ns_.StreamingTag({ customerC2: id_comscore });
else
_marcado._datosMarcado.myStreamingTag = null;
if (_datosVideo.modoSiguientesVideos > 0 )
{
var canal = _datosVideo.agrsNombreNormalizado.split(",")[0];
siguientesVideos(canal, id);
return;
}
}
this.seeking = function()
{
if (_datosVideo.loading)
_datosVideo.loading.className = "playerMPEPV_cloading visible";
}
this.seeked = function()
{
if (_datosVideo.loading)
_datosVideo.loading.className = "playerMPEPV_cloading";
}
this.tipo = function()
{
return _datosVideo._HTML5vsFLASH;
}
this.uid = function()
{
return _datosVideo.uid;
}
this.seccion_creacion = function()
{
return _datosVideo.seccion_creacion;
}
this.fuente = function()
{
return _datosVideo.fuente;
}
this.tags = function()
{
return _datosVideo.tagsIds;
}
this.autores = function()
{
return _datosVideo.autoresIds;
}
if (datosVideo.idRefBrightcove)
datosVideo.id_referencia = datosVideo.idRefBrightcove;
if (datosVideo.playerVideo)
datosVideo.player = datosVideo.playerVideo;
if (datosVideo.tituloVideo)
datosVideo.titulo = datosVideo.tituloVideo;
if (datosVideo.keywordsVideo)
datosVideo.keywords = datosVideo.keywordsVideo;
if (!datosVideo.url_cache)
datosVideo.url_cache = url_cache;
var _datosVideo = datosVideo;
var _idDivVideo = idDivVideo;
var _divVideo = document.getElementById(_idDivVideo);
_divVideo.className = "video_MPEP";
var cadena_titulo;
if (_datosVideo.tituloVideo != undefined && _datosVideo.tituloVideo != "")
cadena_titulo = _datosVideo.tituloVideo;
else
cadena_titulo = PAGE_TITLE;
var _id_video;
if (_datosVideo.id_video)
_id_video = _datosVideo.id_video;
else
{
if (_datosVideo.un)
UN = _datosVideo.un;
_id_video = _datosVideo.id_referencia + UN;
}
_id_video += '-' + (++contadorMultimedia);
if (typeof(_datosVideo.modoReproduccion) == "undefined")
_datosVideo.modoReproduccion = "";
if (dispositivoMovil && typeof(_datosVideo.autoplay) == "boolean")
_datosVideo.autoplay = false;


if (versionMovil || MPEP_responsive)
{
var ancho_ref = (typeof(_divVideo.parentNode) != "undefined" && _divVideo.parentNode.offsetWidth > 0) ? _divVideo.parentNode.offsetWidth : ((typeof(_divVideo.parentNode.parentNode) != "undefined" && _divVideo.parentNode.parentNode.offsetWidth > 0)? _divVideo.parentNode.parentNode.offsetWidth: 640);
_altoMovil = Math.floor(ancho_ref * _datosVideo.altoPlayer / _datosVideo.anchoPlayer);
_anchoMovil = (ancho_ref);
_datosVideo.anchoPlayer = _anchoMovil;
_datosVideo.altoPlayer = _altoMovil;
_divVideo.style.overflow = "hidden";
EPETaddEvent(window, orientationEvent, function(){
clearTimeout(_resizeTM);
_resizeTM = setTimeout( function() {
changeOrientation()}, 300)
});
}
_divVideo.style.width = _datosVideo.anchoPlayer + "px"
_divVideo.style.height = _datosVideo.altoPlayer + "px";
_divVideo.style.backgroundColor = "#000000";
if (typeof(autopromo) != "undefined" && !dispositivoMovil)
datosVideo.autopromo = autopromo;
if (modoSiguientesVideos != 0)
{
datosVideo.agrsNombreNormalizado = SiguientesVideosPEP.fuente_unica;
datosVideo.agrsIds = SiguientesVideosPEP.id_fuente_unica;
}
_datosVideo.modoSiguientesVideos = (modoSiguientesVideos == 0 || typeof(_datosVideo.agrsNombreNormalizado) == "undefined" || _datosVideo.agrsNombreNormalizado == "") ? 0 : (typeof(_datosVideo.modoPlayer) != "undefined" && _datosVideo.modoPlayer != '0' ? _datosVideo.modoPlayer : modoSiguientesVideos);
if (_datosVideo.anchoPlayer < 300)
_datosVideo.modoSiguientesVideos = 0;
if (typeof(MultimediaPEP_originales[_idDivVideo]) == "undefined") {
MultimediaPEP_originales[_idDivVideo] = JSON.parse(JSON.stringify(datosVideo));
}
else
{
if (_datosVideo.modoSiguientesVideos > 0 && borrar)
SiguientesVideosPEP.paraBorrar.push(_id_video);
}
MultimediaPEP[_id_video] = new Object();
MultimediaPEP[_id_video].multimedia = this;
MultimediaPEP[_id_video].modoSiguientesVideos = _datosVideo.modoSiguientesVideos;
MultimediaPEP[_id_video].datos = JSON.parse(JSON.stringify(MultimediaPEP_originales[_idDivVideo]));
MultimediaPEP[_id_video].id = idDivVideo;
_datosVideo.id_video = _id_video;
var primero_flash = videoFlash && !versionMovil;
if ((_datosVideo.forzarHTML5 != undefined && _datosVideo.forzarHTML5) || (typeof(EPET_forzarHTML5) != "undefined" && EPET_forzarHTML5))
primero_flash = false;
var _marcado = new EPET_Marcado_Multimedia({"referencia":_datosVideo.id_video,"titulo": cadena_titulo, "keywords": _datosVideo.keywordsVideo != undefined ? _datosVideo.keywordsVideo : "", "media":"video" });
if (datosVideo.tipoReproduccion && datosVideo.tipoReproduccion == "streaming")
{
_marcado._datosMarcado.tipoReproduccion = "streaming";
_datosVideo.publicidad_post_roll = false;
}
else
{
datosVideo.tipoReproduccion = "vod";
_marcado._datosMarcado.tipoReproduccion = "vod";
if (_datosVideo.modoSiguientesVideos == 0 )
_datosVideo.publicidad_post_roll = typeof(_datosVideo.publicidad_post_roll) != "undefined" ? _datosVideo.publicidad_post_roll : true;
else
{
_datosVideo.publicidad_post_roll = false;
if (typeof (_datosVideo.idx_siguientes_videos) == "undefined")
_datosVideo.idx_siguientes_videos = 0;
var key = _datosVideo.idx_siguientes_videos == 0 ? SiguientesVideosPEP.keyword_primero : SiguientesVideosPEP.keyword_siguientes;
if (typeof(_datosVideo.keywordsVideo) == "undefined" || _datosVideo.keywordsVideo == "")
_datosVideo.keywordsVideo = key;
else
_datosVideo.keywordsVideo += "," + key;
_marcado._datosMarcado.posSiguientesVideos = _datosVideo.idx_siguientes_videos;
}
}
var _idPosicionador = "posicionador_" + _id_video;
var _idDivImage = "divimg_" + _id_video;
var _imgCaratula = "caratula_" + _id_video;
var _idObjeto = "obj_" + _id_video;
var _duration = 0;
var _firstTime = false;
var _anchoMovil = _datosVideo.anchoPlayer;
var _altoMovil = _datosVideo.altoPlayer;
var fullscreen_HTML5 = false;
var _resizeTM;
var _mainController;
var intervalTimmerFotograma;
var urlAdServer;
if (!dispositivoMovil && document.location.href.indexOf("autoplay=1") > -1 && !reproduciendo && datosVideo.autoplay != false)
{
_datosVideo.modoReproduccion = "autoplay";
reproduciendo = true;
_datosVideo.autoplay = true;
var posVideo = EPET_calculaTopPosition(_divVideo);
if (posVideo > dimensionesPEP.alto)
EPET_setScrollPosition(posVideo - 30);
}
var _divCaratula = document.createElement("div");
_divCaratula.id = _idDivImage;
_divCaratula.style.zIndex = 1;
_divCaratula.className = "img_MPEP";
_divCaratula.style.width = _datosVideo.anchoPlayer + "px";
_divCaratula.style.height = _datosVideo.altoPlayer + "px";
_divCaratula.tituloVideo = LANG_MSG[LANG].ver_video;
if( typeof(_datosVideo.tituloVideo) !== 'undefined' && _datosVideo.tituloVideo != '' ){
_divCaratula.tituloVideo = _datosVideo.tituloVideo;
}
var codigoVideo = '<a class="posicionador" id="' + _idPosicionador + '" title="'+ _divCaratula.tituloVideo +'" href="javascript:void(0)">';
if (_anchoMovil > 300)
codigoVideo += '<span class="mosca_elpaistv"></span>';
var cod_img;
if (typeof(window.lzld) == 'function')
cod_img = '<img border="0" width="' + _datosVideo.anchoPlayer + '" height="' + _datosVideo.altoPlayer +'" id="' + _imgCaratula + '" onload="lzld(this)" src="/t.gif" data-src="' + _datosVideo.playerEPETParams["URLMediaStill"] + '" style="height:' + _datosVideo.altoPlayer + 'px" />';
else
cod_img = '<img border="0" width="' + _datosVideo.anchoPlayer + '" height="' + _datosVideo.altoPlayer +'" id="' + _imgCaratula + '" src="' + _datosVideo.playerEPETParams["URLMediaStill"] + '" style="height:' + _datosVideo.altoPlayer + 'px" />';
codigoVideo += '<span class="boton_video"></span>' + cod_img + '</a>';
if (_datosVideo.autoplay && _datosVideo.modoSiguientesVideos > 0)
{
_divCaratula.style.display = 'none';
}
_divCaratula.innerHTML = codigoVideo;
_divVideo.appendChild(_divCaratula);
var _span = document.getElementById(_idPosicionador);
if (_datosVideo.autoplay && !dispositivoMovil)
{
if (_datosVideo.modoReproduccion == "")
_datosVideo.modoReproduccion = "autoplay";
if (!isIE && code_ima3_HTML5_cargado == "nocargado")
{
code_ima3_HTML5_cargado = "cargado";
var ss = document.createElement('script');
ss.type= 'text/javascript';
ss.src = '//s0.2mdn.net/instream/html5/ima3.js';
document.getElementsByTagName('head')[0].appendChild(ss);
}
intervalTimmerFotograma = setTimeout(function(){_divCaratula.style.display = "none";},4000);
if ( !css_multimedia_cargado)
{
css_multimedia_cargado = true;
loadCSS(css_multimedia, function(){setTimeout(dibujaPlayer,1500)},true);
EPETaddEvent(document, mouseWheelEvent, wheel);
}
else
dibujaPlayer();
_span.className += " video_cargando";
}
else
{
if ( !css_multimedia_cargado)
{
css_multimedia_cargado = true;
loadCSS(css_multimedia, null, true);
EPETaddEvent(document, mouseWheelEvent, wheel);
}
if (!isIE && code_ima3_HTML5_cargado == "nocargado")
{
code_ima3_HTML5_cargado = "cargando";
var ss = document.createElement('script');
ss.type= 'text/javascript';
ss.src = '//s0.2mdn.net/instream/html5/ima3.js';
if (document.all)
ss.onreadystatechange = function(){
if (ss.readyState == 'complete' || ss.readyState == 'loaded')
code_ima3_HTML5_cargado = "cargado";
}
else
ss.onload = function() {
code_ima3_HTML5_cargado = "cargado";
};
document.getElementsByTagName('head')[0].appendChild(ss);
}
_divVideo.onclick = function()
{
_datosVideo.modoReproduccion = "organico";
_divVideo.onclick = null;
_span.className += " video_cargando";
if (isIE)
_divCaratula.style.display = "none";
intervalTimmerFotograma = setTimeout(function(){_divCaratula.style.display = "none";},4000);
dibujaPlayer();
MultimediaReproduciendo(_datosVideo.id_video, false);
}
}
function changeOrientation(ancho)
{
var ref;
if (isNaN(ancho))
ref = (typeof(_divVideo.parentNode) != "undefined" && _divVideo.parentNode.offsetWidth > 0) ? _divVideo.parentNode.offsetWidth :
((typeof(_divVideo.parentNode.parentNode) != "undefined" && _divVideo.parentNode.parentNode.offsetWidth > 0)? _divVideo.parentNode.parentNode.offsetWidth:
(typeof(_divVideo.parentNode.parentNode.parentNode) != "undefined" && _divVideo.parentNode.parentNode.parentNode.offsetWidth > 0)? _divVideo.parentNode.parentNode.parentNode.offsetWidth : 640);
else
ref = ancho;
_datosVideo.altoPlayer = Math.floor(ref * _datosVideo.altoPlayer / _datosVideo.anchoPlayer);
_datosVideo.anchoPlayer = ref;
if (_divCaratula)
{
_divCaratula.style.width = _datosVideo.anchoPlayer + "px";
_divCaratula.style.height = _datosVideo.altoPlayer + "px";
if (document.getElementById(_imgCaratula))
{
document.getElementById(_imgCaratula).style.width = _datosVideo.anchoPlayer + "px";
document.getElementById(_imgCaratula).style.height = _datosVideo.altoPlayer + "px";
}
}
if (_mainController && _mainController.adsController)
_mainController.adsController.resize(_datosVideo.anchoPlayer,_datosVideo.altoPlayer);
if (_datosVideo.nodoVideo != null)
{
if (_mainController.playerHTML5.controles)
{
_mainController.playerHTML5.controles.style.left = "0px";
_mainController.playerHTML5.controles.style.marginLeft = "0px";
_mainController.playerHTML5.controles.style.paddingLeft = "0px";
_mainController.playerHTML5.controles.style.paddingRight = "0px";
var limite = (_datosVideo.anchoPlayer > 640 || _mainController.playerHTML5.inFullscreen) ? 640 : _datosVideo.anchoPlayer;
if (_mainController.playerHTML5.controles.barra)
{
_mainController.playerHTML5.controles.barra.style.width = (limite - _mainController.playerHTML5.ancho_controles) + "px";
_mainController.playerHTML5.controles.barra.sliderseek.style.width = _mainController.playerHTML5.controles.barra.style.width;
_mainController.playerHTML5.controles.style.width = limite + "px";
}
if (_datosVideo.anchoPlayer > 640 || _mainController.playerHTML5.inFullscreen)
{
var margen = Math.floor((_mainController.playerHTML5.inFullscreen ? _mainController.playerHTML5.fullscreenWidth : _datosVideo.anchoPlayer) / 2) - 320;
_mainController.playerHTML5.controles.style.left = margen + "px";
_mainController.playerHTML5.controles.style.marginLeft = (-1 * margen) + "px";
var nodo = _mainController.playerHTML5.controles;
setTimeout(function(){
nodo.style.paddingLeft = margen + "px";
},20);
_mainController.playerHTML5.controles.style.paddingRight = margen + "px";
}
}
}
else
{
if (_datosVideo.idObjeto && document.getElementById(_datosVideo.idObjeto))
{
document.getElementById(_datosVideo.idObjeto).width = _datosVideo.anchoPlayer;
document.getElementById(_datosVideo.idObjeto).height = _datosVideo.altoPlayer;
}
}
_divVideo.style.width = _datosVideo.anchoPlayer + "px";
_divVideo.style.height = _datosVideo.altoPlayer + "px";
if (_datosVideo.modoSiguientesVideos > 0)
{
MultimediaPEP[_id_video].datos.anchoPlayer = _datosVideo.anchoPlayer;
MultimediaPEP[_id_video].datos.altoPlayer = _datosVideo.altoPlayer;
}
}
function ocultaFotograma()
{
clearTimeout(intervalTimmerFotograma);
_divCaratula.style.visibility = "hidden";
_divCaratula.innerHTML= "";
}
function dibujaPlayer()
{
if (typeof(_datosVideo.publiActiva) == "string")
if (_datosVideo.publiActiva == "true")
_datosVideo.publiActiva = true;
else
{
_datosVideo.publiActiva = false;
}
if (!_datosVideo.seekTimeout)
_datosVideo.seekTimeout = 7;
if (_datosVideo.publiActiva)
{
_datosVideo.publicidad_pre_roll = true;
}
else
{
_datosVideo.publicidad_pre_roll = false;
_datosVideo.publicidad_post_roll = false;
}
_marcado._datosMarcado.publicidad = _datosVideo.publiActiva ? "con publicidad" : "sin publicidad";
var keywords = "";
if (_datosVideo.tagsNombreNormalizado != undefined && _datosVideo.tagsNombreNormalizado != "")
keywords = _datosVideo.tagsNombreNormalizado;
else
if (typeof(listado_norm_tags) != "undefined" && listado_norm_tags != "")
keywords = listado_norm_tags;
if (_datosVideo.keywordsVideo != undefined && _datosVideo.keywordsVideo != "")
{
if (keywords != "")
keywords += "," + _datosVideo.keywordsVideo;
else
keywords = _datosVideo.keywordsVideo;
}
if (_datosVideo.agrsNombreNormalizado != undefined && _datosVideo.agrsNombreNormalizado != "")
{
_marcado._datosMarcado.agrs_video = _datosVideo.agrsNombreNormalizado;
if (keywords != "")
keywords += "," + _datosVideo.agrsNombreNormalizado;
else
keywords = _datosVideo.agrsNombreNormalizado;
}
keywords = "&hl=" + (LANG == "pt-br" ? "pt" : LANG  ) +  "&cust_params=pbskey%3D" + escape(keywords) + "%26pos%3D{cuePointType}" +
(typeof(PBS) != "undefined" && typeof(PBS.slm) != "undefined" && typeof(PBS.slm.cf) != "undefined" && typeof(PBS.slm.cf.key) != "undefined" && typeof(PBS.slm.cf.key.cXseg) != "undefined" ? "%26CxSegments%3D" + escape(PBS.slm.cf.key.cXseg.join(",")) : "");
if (_datosVideo.keywordsVideo.indexOf("agencia_overonaelpais") > -1 || _datosVideo.keywordsVideo.indexOf("agencia_reuters_live") > -1 || _datosVideo.keywordsVideo.indexOf("overon_stream") > -1)
urlAdServer = UrlPublicidadOveron + keywords;
else
{
if (_datosVideo.keywordsVideo.indexOf("agencia_cnbc") > -1)
urlAdServer = UrlPublicidadCnbc + keywords;
else
urlAdServer = UrlPublicidad + keywords;
}
if (versionMovil || (MPEP_responsive && dimensionesPEP.ancho < anchoReferenciaMobile))
urlAdServer = urlAdServer.replace("_web%2F", "_mob%2F");
_marcado._datosMarcado.duracion = 0;
_marcado._datosMarcado.adCue = "";
_marcado._datosMarcado.ad = "";
_marcado._datosMarcado.adTitle = "";
_marcado._datosMarcado.tags = "";
_marcado._datosMarcado.autores = "";
_marcado._datosMarcado.modoReproduccion = _datosVideo.modoReproduccion;
_datosVideo._HTML5vsFLASH = "";
if ( primero_flash)
{
_datosVideo._HTML5vsFLASH = "flash";
pideDatosVideo(_id_video);
}
else
{
if (canPlayMP4 || canPlayHLS)
{
_datosVideo._HTML5vsFLASH = "html5";
creaPlayerHTML5();
}
else
{
if  (videoFlash )
{
_datosVideo._HTML5vsFLASH = "flash";
pideDatosVideo(_id_video);
}
else
sinPlayer();
}
}
}
function creaPlayerFlash()
{
_datosVideo.adServerURL = urlAdServer + "%26fpd%3Dvpaid";
var params = {"menu":"false", "wmode":"opaque", "allowscriptaccess":"always", "bgcolor":"#000000", "allowfullscreen":"true" };
for(var key in _datosVideo.playerEPETOpcionesSWF)
{
params[key] = _datosVideo.playerEPETOpcionesSWF[key];
}
_datosVideo.autoplay = true;
_datosVideo.idioma = LANG;
_datosVideo.un = UN;
_datosVideo.enlazados = _datosVideo.modoSiguientesVideos > 0;
var copia_flashvars = JSON.parse(JSON.stringify(_datosVideo));
delete(copia_flashvars.playerEPETOpcionesSWF);
var claves = ["src", "adServerURL", "spriteImg", "caratula", "rtmpStream", "hlsod", "m3u8", "poster"];
for(var key=0; key < claves.length; key++)
{
if (typeof(copia_flashvars[claves[key]]) != "undefined" && copia_flashvars[claves[key]].substr(0,2) == '//')
copia_flashvars[claves[key]] = document.location.protocol + copia_flashvars[claves[key]];
}
if (typeof(copia_flashvars.playerEPETParams.URLMediaFile) != "undefined" && copia_flashvars.playerEPETParams.URLMediaFile.substr(0,2) == '//')
copia_flashvars.playerEPETParams.URLMediaFile = document.location.protocol + copia_flashvars.playerEPETParams.URLMediaFile;
if (typeof(copia_flashvars.playerEPETParams.URLMediaStill) != "undefined" && copia_flashvars.playerEPETParams.URLMediaStill.substr(0,2) == '//')
copia_flashvars.playerEPETParams.URLMediaStill = document.location.protocol + copia_flashvars.playerEPETParams.URLMediaStill;
if (typeof(copia_flashvars.playerEPETParams.URLFirstFrame) != "undefined" && copia_flashvars.playerEPETParams.URLFirstFrame.substr(0,2) == '//')
copia_flashvars.playerEPETParams.URLFirstFrame = document.location.protocol + copia_flashvars.playerEPETParams.URLFirstFrame;
params["flashvars"] = "datosVideo=" + escape(JSON.stringify(copia_flashvars));
var multimedia_player;
var player = (_datosVideo.hlsod && _datosVideo.hlsod != "") ? url_reproductor_epet_live : url_reproductor_epet;
multimedia_player = new EPET_FlashHTML(11, player, _datosVideo.anchoPlayer, _datosVideo.altoPlayer, params, _idObjeto );
_datosVideo.idObjeto = _idObjeto;
multimedia_player.append(_idDivVideo);
if (_datosVideo.hlsod && _datosVideo.hlsod != "")
{
_datosVideo.loading = document.createElement("div");
_datosVideo.loading.className = "playerMPEPV_cloading";
var circulo = document.createElement("div");
circulo.className = "playerMPEPV_loading";
_datosVideo.loading.appendChild(circulo);
_divVideo.appendChild(_datosVideo.loading);
}
ocultaFotograma();
}
function creaPlayerHTML5()
{
if (_datosVideo.tipoReproduccion != undefined && _datosVideo.tipoReproduccion == "streaming")
{
if (_datosVideo.m3u8 == undefined || _datosVideo.m3u8 == "" || (!dispositivoMovil && !canPlayHLS))
{
sinPlayer(1);
return;
}
}
if (_datosVideo.publiActiva && publicidad_HTML5 &&  code_ima3_HTML5_cargado == "cargado" )
{
_datosVideo.publicidad_pre_roll = true;
_datosVideo.publicidad_post_roll = _datosVideo.publicidad_post_roll && postroll_HTML5;
}
else
{
_datosVideo.publiActiva = false;
_datosVideo.publicidad_pre_roll = false;
_datosVideo.publicidad_post_roll = false;
}
if (_marcado._datosMarcado.tipoReproduccion == "streaming")
_marcado._datosMarcado.playerName = "HTML5 VÍDEO V2 - Transmisiones";
else
_marcado._datosMarcado.playerName = "HTML5 VÍDEO V2";
_datosVideo.marcado = _marcado;
_datosVideo.adServerURL = urlAdServer.replace("%2Fflash","%2Fhtml5");
_datosVideo.nodoVideo = document.createElement("video");
_datosVideo.nodoVideo.className = "playerMPEPV_video";
if (dispositivoMovil)
_datosVideo.nodoVideo.play();
_mainController = new MainController(new playerHTML5(_divVideo,_datosVideo, _id_video));
pideDatosVideo(_id_video);
ocultaFotograma();
}
function sinPlayer(cod)
{
clearTimeout(intervalTimmerFotograma);
_span.parentNode.parentNode.className += " video_previa video_no_disponible";
var spanFondo = document.createElement("span");
spanFondo.className = "fondo_mensaje_video";
var spanBoton = document.createElement("span");
spanFondo.appendChild(spanBoton);
_span.parentNode.appendChild(spanFondo);
if (cod)
{
spanBoton.innerHTML = LANG_MSG[LANG].trans_no_disponible;
}
else
{
if (versionFlash > 0) {
spanBoton.innerHTML = LANG_MSG[LANG].actualizar_plugin;
}
else {
spanBoton.innerHTML = LANG_MSG[LANG].no_mp4;
}
}
}
this.resize = changeOrientation;
}
var playerHTML5 = function(contenedor, datosVideo, padre)
{
this.padre = padre;
this.contenedorVideo = typeof contenedor == 'object' ? contenedor : document.getElementById(contenedor);
this.datosVideo = datosVideo;
this.width = this.datosVideo.anchoPlayer;
this.height = this.datosVideo.altoPlayer;
this.contenedorVideo.style.width = this.width + "px";
this.contenedorVideo.style.height = this.height + "px";
this.contenedorVideo.className = "playerMPEPV_c_video playerMPEPV_unselectable";
this.adContainer = null;
this.controles = null;
this.adTagUrl = this.datosVideo.adServerURL;
this.primeraVez = true;
this.autoplay = this.datosVideo.autoplay;
this.controlesNativosVideo = controlesNativosVideo ? controlesNativosVideo : (dispositivoMovil ? true : false);
this.adSaltar = null;
this.playing = false;
this.inFullscreen = false;
this.fullscreenWidth = 0;
this.fullscreenHeight = 0;
this.marcado = this.datosVideo.marcado;
this.nodoVideo = this.datosVideo.nodoVideo;
this.nodoVideo.style.position = 'absolute';
this.nodoVideo.style.zIndex = 0;
this.nodoVideo.style.top = '0px';
this.nodoVideo.style.left = '0px';
this.nodoVideo.setAttribute("id", "pepvideo_" + this.datosVideo.id_video);
this.datosVideo.isMuted = ( typeof(this.datosVideo.mute) != "undefined" && this.datosVideo.mute);
if (this.datosVideo.modoSiguientesVideos == 0)
this.nodoVideo.setAttribute("poster", this.datosVideo.playerEPETParams.URLMediaStill);
this.nodoVideo.style.display = 'none';
this.contenedorVideo.appendChild(this.nodoVideo);
this.volumenActual = this.nodoVideo.volume;
this.ancho_controles = 0;
if (typeof(google) == "undefined" || typeof(google.ima) == "undefined")
this.datosVideo.publiActiva = false;
if (this.datosVideo.publiActiva)
{
this.adContainer = document.createElement('div');
this.adContainer.style.position = "absolute";
this.adContainer.style.cursor = "pointer";
this.adContainer.style.left = "0px";
this.adContainer.style.top = "0px";
this.adContainer.style.width = this.width + "px";
this.adContainer.style.height = this.height + "px";
this.adContainer.style.zIndex = 2;
this.contenedorVideo.appendChild(this.adContainer);
if (!isIphone)
{
this.creaControles();
this.adSaltar = document.createElement('div');
this.adSaltar.className = "playerMPEPV_adsaltar";
if (dispositivoMovil)
this.adSaltar.innerHTML = '<img src="'+ LANG_MSG[LANG].vervideo_svg+'" width="146" height="40" border="0" style="width:146px;height:40px" \/>';
else
this.adSaltar.innerHTML = '<img src="'+ LANG_MSG[LANG].vervideo_svg+'" width="84" height="23" border="0" style="width:84px;height:23px" \/>';
this.contenedorVideo.appendChild(this.adSaltar);
}
}
else
{
this.nodoVideo.style.display = 'block';
if (this.controlesNativosVideo)
this.nodoVideo.setAttribute ( "controls" , "controls" );
else
this.creaControles();
}
};
playerHTML5.prototype.preloadContent = function(contentLoadedAction) {
if (dispositivoMovil)
{
this.nodoVideo.addEventListener(
'loadedmetadata',
contentLoadedAction,
false);
this.nodoVideo.load();
}
else
contentLoadedAction();
};
playerHTML5.prototype.play = function() {
this.nodoVideo.play();
this.playing = true;
if (!this.controlesNativosVideo && this.controles)
this.controles.playpause.className = "playerMPEPV_boton_play_pause playerMPEPV_boton_pause";
MultimediaReproduciendo(this.datosVideo.id_video, false);
};
playerHTML5.prototype.pause = function() {
this.nodoVideo.pause();
this.playing = false;
if (!this.controlesNativosVideo && this.controles)
this.controles.playpause.className = "playerMPEPV_boton_play_pause playerMPEPV_boton_play";
};
playerHTML5.prototype.setVolume = function(volumen) {
if (volumen > 1 || volumen < 0 )
return;
this.nodoVideo.volume = volumen;
this.actualizaVolumen();
};
playerHTML5.prototype.actualizaVolumen = function()
{
var volumen = this.nodoVideo.volume || 0;
if (volumen == 0)
this.controles.volumen.nivel.style.height = '0px';
else
this.controles.volumen.nivel.style.height = (this.controles.volumen.maximo * volumen) + 'px';
volumen_global = volumen;
};
playerHTML5.prototype.resize = function(
position, top, left, width, height) {
this.videoPlayerContainer.style.position = position;
this.videoPlayerContainer.style.top = top + 'px';
this.videoPlayerContainer.style.left = left + 'px';
this.videoPlayerContainer.style.width = width + 'px';
this.videoPlayerContainer.style.height = height + 'px';
};
playerHTML5.prototype.getVideoPlayer = function() {
return this.nodoVideo;
};
playerHTML5.prototype.creaControles = function() {
this.controles = document.createElement("div");
this.controles.className = "playerMPEPV_controles";
this.controles.style.zIndex = "10";
var ancho_maximo = 640;
var margen = 0;
if (this.width > 640)
{
margen = this.width / 2 - 320;
this.controles.style.width = "640px";
this.controles.style.left =  margen + "px";
this.controles.style.marginLeft = (-1 * margen) + "px";
this.controles.style.paddingLeft = margen + "px";
this.controles.style.paddingRight = margen + "px";
}
else
{
this.controles.style.width =  this.width + "px";
ancho_maximo = this.width;
}
this.controles.style.visibility = 'hidden';
var boton_play_pause = document.createElement("span");
boton_play_pause.className = "playerMPEPV_boton_play_pause playerMPEPV_boton_play";
var em = document.createElement("em");
em.appendChild ( document.createTextNode ( "PLAY" ) );
boton_play_pause.appendChild(em);
this.controles.appendChild(boton_play_pause);
this.controles.playpause = boton_play_pause;
var tiempo = document.createElement("span");
tiempo.className = "playerMPEPV_posicion";
em = document.createElement("em");
em.appendChild ( document.createTextNode ( "00:00" ) );
tiempo.appendChild(em);
tiempo.texto = em;
this.controles.appendChild(tiempo);
this.controles.tiempo = tiempo;
var barra = document.createElement("span");
barra.className = "playerMPEPV_barra";
em = document.createElement("em");
barra.appendChild(em);
barra.progreso = em;
var sliderseek = document.createElement("div");
sliderseek.className = "playerMPEPV_sliderseek";
barra.appendChild(sliderseek);
barra.sliderseek = sliderseek;
this.controles.appendChild(barra);
this.controles.barra = barra;
var duracion = document.createElement("span");
duracion.className = "playerMPEPV_duracion";
em = document.createElement("em");
em.appendChild ( document.createTextNode ( "00:00" ) );
duracion.appendChild(em);
duracion.texto = em;
this.controles.appendChild(duracion);
this.controles.textoDuracion = duracion;
var pantalla_completa = document.createElement("span");
pantalla_completa.className = "playerMPEPV_pantalla_completa";
pantalla_completa.innerHTML = "PC";
this.controles.appendChild(pantalla_completa);
this.controles.fullscreen = pantalla_completa;
var volumen = document.createElement("span");
em = document.createElement("em");
var altavoz = document.createElement("span");
altavoz.className = "playerMPEPV_altavoz";
em.appendChild ( altavoz );
volumen.appendChild(em);
this.controles.appendChild(volumen);
volumen.altavoz = em;
volumen.style.position = "relative";
var slider = document.createElement("div");
slider.className = "playerMPEPV_slider";
var selectorNivel = document.createElement("div");
selectorNivel.className = 'playerMPEPV_selector_nivel';
selectorNivel.id = "vdpep_audio"
slider.appendChild(selectorNivel);
var nivel = document.createElement("div");
nivel.className = "playerMPEPV_nivel_slider";
slider.appendChild(nivel);
volumen.appendChild(slider);
volumen.slider = slider;
volumen.selectorNivel = selectorNivel;
volumen.nivel = nivel;
this.contenedorVideo.appendChild(this.controles);
this.controles.volumen = volumen;
slider.style.bottom = ( volumen.offsetHeight ) + "px";
this.ancho_controles += boton_play_pause.offsetWidth;
this.ancho_controles += tiempo.offsetWidth;
this.ancho_controles += duracion.offsetWidth;
this.ancho_controles += pantalla_completa.offsetWidth;
this.ancho_controles += volumen.offsetWidth;
barra.style.width = (this.controles.offsetWidth - 2 * margen - this.ancho_controles) + "px";
barra.sliderseek.style.width = barra.style.width;
this.controles.volumen.maximo = slider.offsetHeight - 6;
this.controles.style.display = "block";
if (!dispositivoMovil)
{
var datosv = this.datosVideo;
volumen.onmouseover = function() {
if (!datosv.isMuted) slider.style.visibility = "visible"
};
volumen.onmouseout = function() { slider.style.visibility = "hidden" };
this.actualizaVolumen();
this.pausado = document.createElement("div");
this.pausado.className = "playerMPEPV_pausado";
var play = document.createElement("span");
play.className = "playerMPEPV_pausado_play";
this.pausado.appendChild(play);
this.contenedorVideo.appendChild(this.pausado);
}
};
playerHTML5.prototype.fullscreenChange = function(e)
{
if (!screenfull.isFullscreen)
{
document.removeEventListener(screenfull.raw.fullscreenchange, screenfull.func,true);
this.fullscreenWidth = MultimediaPEP[this.padre].datos.playerEPETParams.mediaWidth;
this.inFullscreen = false;
if (!versionMovil)
MultimediaPEP[this.padre].multimedia.resize(this.fullscreenWidth);
}
};
playerHTML5.prototype.fullscreen = function() {
if (dispositivoMovil && this.datosVideo.webkitSupportFullscreen)
{
this.nodoVideo.webkitEnterFullscreen();
this.nodoVideo.addEventListener('webkitendfullscreen',	this.bind(this, this.fullscreenChange),false);
}
else
{
if (screenfull.enabled)
{
if (screenfull.isFullscreen)
{
screenfull.exit();
this.inFullscreen = false;
this.fullscreenWidth = MultimediaPEP[this.padre].datos.playerEPETParams.mediaWidth;
this.fullscreenHeight = MultimediaPEP[this.padre].datos.playerEPETParams.mediaHeight;
}
else
{
screenfull.request(this.contenedorVideo);
this.inFullscreen = true;
this.fullscreenWidth = IEv > 9 ? window.innerWidth : window.screen.width;
this.fullscreenHeight =  IEv > 9 ? window.innerHeight :window.screen.height;
screenfull.func = this.fullscreenChange.bind(this);
document.addEventListener(screenfull.raw.fullscreenchange, screenfull.func, true);
}
var padre = this.padre;
var w = this.fullscreenWidth;
if (!versionMovil)
setTimeout(	function(){MultimediaPEP[padre].multimedia.resize(w);},30);
}
}
};
var MainController = function(playerHTML5) {
this.playerHTML5 = playerHTML5;
this.duracion = -1;
this.firstTime = false;
this.adsActive = false;
this.adsDone = false;
this.fullscreen = false;
this.adPlaying = false;
this.adsController = null;
this.puntoMedio = false;
this.finVideo = false;
this.hlsObj = null;
this.playerHTML5.datosVideo.loading = null;
this.playerHTML5.datosVideo.webkitSupportFullscreen = false;
this.video = this.playerHTML5.nodoVideo;
if (this.playerHTML5.controles)
{
this.barra = this.playerHTML5.controles.barra;
this.playButton = this.playerHTML5.controles.playpause;
this.boton = -1;
if (this.playerHTML5.adSaltar != null)
{
this.adSkip = this.playerHTML5.adSaltar;
this.adSkip.addEventListener(
'click',
this.bind(this, this.onAdSkip),
false);
}
this.playButton.addEventListener(
'click',
this.bind(this, this.onClick),
false);
this.fullscreenButton = this.playerHTML5.controles.fullscreen;
this.fullscreenButton.addEventListener(
'click',
this.bind(this, this.onFullscreenClick),
false);
this.barra.sliderseek.addEventListener(
'click',
this.bind(this, this.seek),
false);
this.volumen = this.playerHTML5.controles.volumen;
this.tiempo = this.playerHTML5.controles.tiempo;
this.textoDuracion = this.playerHTML5.controles.textoDuracion;
this.volumen.altavoz.addEventListener(
'click',
this.bind(this, this.onAltavozClick),
false);
this.volumen.selectorNivel.addEventListener(
'click',
this.bind(this, this.onSliderClick),
false);
this.volumen.selectorNivel.addEventListener(
'mousemove',
this.bind(this, this.onSliderMouseMove),
false);
this.volumen.selectorNivel.addEventListener(
'mousedown',
this.bind(this, this.onSliderMouseDown),
false);
this.volumen.selectorNivel.addEventListener(
'mouseup',
this.bind(this, this.onSliderMouseUp),
false);
this.volumen.selectorNivel.addEventListener(
mouseWheelEvent,
this.bind(this, this.onMousewheel),
false);
if (this.playerHTML5.datosVideo.isMuted && !dispositivoMovil)
this.onAltavozClick();
}
this.video.addEventListener(
'timeupdate',
this.bind(this, this.onTimeupdate),
false);
this.video.addEventListener(
'play',
this.bind(this, this.onPlayPausevideo),
false);
this.video.addEventListener(
'pause',
this.bind(this, this.onPlayPausevideo),
false);

this.video.addEventListener(
mouseWheelEvent,
this.bind(this, this.onMousewheel),
false);
if (this.playerHTML5.adContainer != null)
this.adsController = new AdsController(this, this.playerHTML5);
if (this.playerHTML5.pausado)
{
this.video.addEventListener(
'click',
this.bind(this, this.onPause),
false);
this.playerHTML5.pausado.addEventListener(
'mouseover',
this.bind(this, this.onPauseMouseOver),
false);
this.playerHTML5.pausado.addEventListener(
'click',
this.bind(this, this.onPauseClick),
false);
}
this.onClick();
};
MainController.prototype.cargaDatos = function(nuevosDatos)
{
for (var key in nuevosDatos)
this.playerHTML5.datosVideo[key] = nuevosDatos[key];
if (this.playerHTML5.datosVideo.m3u8 && (dispositivoMovil || canPlayHLS))
{
this.playerHTML5.datosVideo.hlsod = this.playerHTML5.datosVideo.m3u8;
}
if (this.playerHTML5.datosVideo.hlsod && this.playerHTML5.datosVideo.hlsod != "" )
{
if ( canPlayHLS && Hls)
{
this.hlsObj = new Hls({debug:false});
this.hlsObj.on(Hls.Events.MEDIA_ATTACHED, this.bind(this, this.onHlsAttached));
var hls = this.hlsObj;
this.hlsObj.on(Hls.Events.ERROR, function(event,data) {
if (data.fatal) {
try{
hls.swapAudioCodec();
}
catch(e)
{
console.info("fatal error");
}
console.log("Error gordo");
hls.recoverMediaError();
}
});
this.hlsObj.attachMedia(this.video);
this.video.addEventListener('seeking', this.bind(this, this.onSeeking),false);
this.video.addEventListener('seeked', this.bind(this, this.onSeeked),false);
this.playerHTML5.datosVideo.loading = document.createElement("div");
this.playerHTML5.datosVideo.loading.className = "playerMPEPV_cloading";
var circulo = document.createElement("div");
circulo.className = "playerMPEPV_loading";
this.playerHTML5.datosVideo.loading.appendChild(circulo);
this.playerHTML5.contenedorVideo.appendChild(this.playerHTML5.datosVideo.loading);
}
else
{
if (dispositivoMovil)
this.video.setAttribute("src", this.playerHTML5.datosVideo.hlsod);
else
this.video.setAttribute("src", this.playerHTML5.datosVideo.src);
}
}
else
{
this.video.setAttribute("src", this.playerHTML5.datosVideo.src);
}
if (userAgent.indexOf("android") > -1 && typeof(connectionPEP) != "undefined" && connectionPEP.type == "cellular")
{
this.video.load();
}
if (this.playerHTML5.datosVideo.spriteImg && this.playerHTML5.datosVideo.nSprites > 0 && !dispositivoMovil)
{
var thumbnails = document.createElement("div");
thumbnails.className = 'playerMPEPV_thumbnails';
thumbnails.id = 'thumbnails';
em = document.createElement("div");
em.className = "playerMPEPV_time";
em.appendChild ( document.createTextNode ( "00:00" ) );
thumbnails.appendChild(em);
thumbnails.time = em;
this.barra.appendChild(thumbnails);
thumbnails.style.backgroundImage = 'url(' + this.playerHTML5.datosVideo.spriteImg + ')';
this.playerHTML5.controles.thumbnails = thumbnails;
thumbnails.onmouseover = function(e) { thumbnails.style.visibility = "hidden";
e.stopPropagation();
}
this.playerHTML5.controles.barra.onmouseover = function(e) {
thumbnails.style.visibility = "visible"
}
this.barra.sliderseek.ns = this.playerHTML5.datosVideo.nSprites;
this.barra.sliderseek.onmouseout = function() { thumbnails.style.visibility = "hidden" }
this.barra.sliderseek.onmousemove = function(e) {
var pos = e.layerX  / e.target.offsetWidth;
var n = Math.floor(pos * this.ns);
var fila = 0;
var columna = 0;
if (n < this.ns)
{
fila = Math.floor(n / 10);
columna = n % 10;
thumbnails.style.backgroundPosition = (-1 * columna * 100) + 'px ' + (-1 * fila * 56) + 'px';
thumbnails.style.left = (pos * e.target.offsetWidth - 30 ) + 'px';
}
}
}
if (!dispositivoMovil)
{
if (this.playerHTML5.controles.thumbnails)
{
this.time = this.playerHTML5.controles.thumbnails.time;
this.playerHTML5.controles.barra.sliderseek.addEventListener(
'mousemove',
this.bind(this, this.seekmove),
false);
}
this.volumen.addEventListener(
'mouseout',
this.bind(this, this.volumenMouseOut),
false);
}
}
MainController.prototype.bind = function(thisObj, fn)
{
return function() {
fn.apply(thisObj, arguments);
};
};
MainController.prototype.onHlsAttached = function(e)
{
this.hlsObj.loadSource(this.playerHTML5.datosVideo.hlsod);
}
MainController.prototype.onSeeking = function(e)
{
if (this.playerHTML5.datosVideo.loading)
this.playerHTML5.datosVideo.loading.className = "playerMPEPV_cloading visible";
}
MainController.prototype.onSeeked = function(e)
{
if (this.playerHTML5.datosVideo.loading)
this.playerHTML5.datosVideo.loading.className = "playerMPEPV_cloading";
}
MainController.prototype.onPause = function(e)
{
if (!this.playerHTML5.playing )
return;
this.playerHTML5.pausado.style.display = "block";
this.pause();
}
MainController.prototype.onPauseMouseOver = function(e)
{
this.playerHTML5.controles.style.display = 'none';
}
MainController.prototype.onPauseClick = function(e)
{
this.resumeAfterAd();
this.adsDone = true;
this.playerHTML5.pausado.style.display = "none";
this.playerHTML5.controles.style.display = 'block';
}
MainController.prototype.onPlayPausevideo = function(e)
{
if (e.type == "pause")
{
if (Math.abs(e.target.duration - e.target.currentTime) < 0.5)
return;
}
this.playerHTML5.marcado._datosMarcado.currentTime = e.target.currentTime;
this.playerHTML5.marcado.marcaComscore(e.type);
}
MainController.prototype.onTimeupdate = function(e)
{
if (isNaN(e.target.duration) || e.target.duration < 0 ||  this.video.currentTime < 0.1 || (this.playerHTML5.datosVideo.tipoReproduccion == "streaming" && !this.playerHTML5.playing))
{
e.preventDefault();
return false;
}
if (!this.firstTime)
{
if (this.playerHTML5.controlesNativosVideo)
{
this.playerHTML5.nodoVideo.setAttribute ( "controls" , "controls" );
}
this.firstTime = true;
this.puntoMedio = false;
this.playerHTML5.nodoVideo.style.display = 'block';
if (this.playerHTML5.controles)
{
this.playerHTML5.controles.style.visibility = 'visible';
if (this.playerHTML5.datosVideo.tipoReproduccion == "streaming")
{
this.playerHTML5.controles.tiempo.style.width = (this.playerHTML5.controles.tiempo.offsetWidth + this.playerHTML5.controles.barra.offsetWidth) + "px";
this.playerHTML5.controles.tiempo.style.textAlign = "left";
this.playerHTML5.controles.tiempo.texto.innerHTML = (LANG_MSG[LANG].directo).toUpperCase()
this.playerHTML5.controles.barra.style.display = "none";
this.playerHTML5.controles.textoDuracion.style.visibility = "hidden";
}
}
if (this.playerHTML5.adContainer != null)
this.playerHTML5.adContainer.style.display = 'none';
this.duracion = this.playerHTML5.datosVideo.tipoReproduccion != 'streaming' ? e.target.duration : -1;
if (!this.playerHTML5.controlesNativosVideo)
this.actualizaTiempo(-1);
this.playerHTML5.marcado._datosMarcado.ad = "";
this.playerHTML5.marcado._datosMarcado.adCue = "";
this.playerHTML5.marcado._datosMarcado.duracion = this.duracion;
if (typeof(this.playerHTML5.marcado._datosMarcado.adTitle) == "undefined" || this.playerHTML5.marcado._datosMarcado.adTitle.indexOf(":-:") == -1)
this.playerHTML5.marcado._datosMarcado.adTitle = "";
this.playerHTML5.marcado._datosMarcado.uid = this.playerHTML5.datosVideo.uid;
this.playerHTML5.marcado._datosMarcado.seccion_creacion = this.playerHTML5.datosVideo.seccion_creacion;
this.playerHTML5.marcado._datosMarcado.fuente = this.playerHTML5.datosVideo.fuente;
this.playerHTML5.marcado._datosMarcado.tags = this.playerHTML5.datosVideo.tagsIds;
this.playerHTML5.marcado._datosMarcado.autores = this.playerHTML5.datosVideo.autoresIds;
this.playerHTML5.marcado._datosMarcado.currentTime = 0;
this.playerHTML5.marcado.marcaEvento("mediaBegin");
MultimediaReproduciendo(this.playerHTML5.datosVideo.id_video, false);
}
if (this.playerHTML5.datosVideo.tipoReproduccion == 'streaming')
return;
if (!this.playerHTML5.controlesNativosVideo && this.playerHTML5.controles)
{
this.tiempo.texto.innerHTML = tiempoBonito( this.video.currentTime );
this.barra.progreso.style.width = (this.video.currentTime * 100  / this.duracion) + "%";
}
if (!this.puntoMedio && Math.abs(this.duracion/2 - this.video.currentTime) < 0.3)
{
this.puntoMedio = true;
this.playerHTML5.marcado._datosMarcado.ad = "";
this.playerHTML5.marcado._datosMarcado.adCue = "";
this.playerHTML5.marcado._datosMarcado.duracion = this.duracion;
this.playerHTML5.marcado._datosMarcado.adTitle = "";
this.playerHTML5.marcado._datosMarcado.uid = this.playerHTML5.datosVideo.uid;
this.playerHTML5.marcado._datosMarcado.seccion_creacion = this.playerHTML5.datosVideo.seccion_creacion;
this.playerHTML5.marcado._datosMarcado.fuente = this.playerHTML5.datosVideo.fuente;
this.playerHTML5.marcado._datosMarcado.tags = this.playerHTML5.datosVideo.tagsIds;
this.playerHTML5.marcado._datosMarcado.autores = this.playerHTML5.datosVideo.autoresIds;
this.playerHTML5.marcado._datosMarcado.currentTime = this.video.currentTime;
this.playerHTML5.marcado.marcaEvento("halfmediaComplete");
}
if (!this.finVideo && Math.abs(this.duracion - this.video.currentTime) < 0.3)
{
this.finVideo = true;
var nn = this;
setTimeout(function(){nn.onContentEnded();},300);
}
};
MainController.prototype.onContentEnded = function() {
this.playerHTML5.marcado._datosMarcado.ad = "";
this.playerHTML5.marcado._datosMarcado.adCue = "";
this.playerHTML5.marcado._datosMarcado.duracion = this.duracion;
this.playerHTML5.marcado._datosMarcado.uid = this.playerHTML5.datosVideo.uid;
this.playerHTML5.marcado._datosMarcado.adTitle = "";
this.playerHTML5.marcado._datosMarcado.seccion_creacion = this.playerHTML5.datosVideo.seccion_creacion;
this.playerHTML5.marcado._datosMarcado.fuente = this.playerHTML5.datosVideo.fuente;
this.playerHTML5.marcado._datosMarcado.tags = this.playerHTML5.datosVideo.tagsIds;
this.playerHTML5.marcado._datosMarcado.autores = this.playerHTML5.datosVideo.autoresIds;
this.playerHTML5.marcado._datosMarcado.currentTime = this.duracion;
this.playerHTML5.marcado.marcaEvento("mediaComplete");
if (typeof(this.playerHTML5.datosVideo.autopromo) != "undefined" && this.playerHTML5.datosVideo.autopromo != "")
{
this.playerHTML5.nodoVideo.setAttribute("src", this.playerHTML5.datosVideo.autopromo);
this.playerHTML5.controles.style.height = "0px";
this.playerHTML5.nodoVideo.addEventListener("ended", this.bind(this, this.onAutopromoEnd),
false);
this.playerHTML5.datosVideo.autopromo = "";
this.playerHTML5.nodoVideo.play();
return;
}
if (this.playerHTML5.datosVideo.publicidad_post_roll)
{
this.adsDone = false;
if (this.adsController)
this.adsController.contentEnded();
}
else
{
this.restart();
}
};
MainController.prototype.onAutopromoEnd = function()
{
this.playerHTML5.nodoVideo.removeEventListener("ended", this.onAutopromoEnd);
this.restart();
this.playerHTML5.controles.style.height = "30px";
}
MainController.prototype.restart = function()
{
if (this.playerHTML5.controlesNativosVideo)
this.playerHTML5.nodoVideo.setAttribute ( "controls" , "controls" );
if (this.playerHTML5.controles && this.playerHTML5.controles.thumbnails)
this.playerHTML5.controles.thumbnails.style.visibility = "hidden";
if (this.adPlaying)
{
this.ocultaSaltar();
this.playerHTML5.marcado._datosMarcado.adCurrentTime = this.adsController.currentTime;
this.adsController.adSkip();
this.playerHTML5.nodoVideo.style.display = 'block';
}
else
{
this.playerHTML5.nodoVideo.currentTime = 0.01;
this.playerHTML5.nodoVideo.pause();
this.playerHTML5.playing = false;
this.playerHTML5.marcado._datosMarcado.currentTime = 0;
}
this.updateChrome();
this.adsDone = false;
this.firstTime = false;
this.finVideo = false;
this.playerHTML5.marcado.eventos = {};
if (typeof(ns_) != "undefined" && typeof(id_comscore) != "undefined")
this.playerHTML5.marcado._datosMarcado.myStreamingTag = new ns_.StreamingTag({ customerC2: id_comscore });
else
this.playerHTML5.marcado._datosMarcado.myStreamingTag = null;
if (this.adsController)
{
this.adsController.contentCompleteCalled = false;
this.adsController.adPosition = "pre-roll";
}
if (this.playerHTML5.datosVideo.modoSiguientesVideos > 0 )
{
var canal = this.playerHTML5.datosVideo.agrsNombreNormalizado.split(",")[0];
siguientesVideos( canal, this.playerHTML5.datosVideo.id_video);
return;
}
this.playerHTML5.pausado.style.display = "block";
this.playerHTML5.playing = false;
}
MainController.prototype.actualizaTiempo = function(tiempo, ad)
{
if (isIphone)
return;
if (ad)
{
if (tiempo == 0)
this.textoDuracion.texto.innerHTML = "";
else
this.textoDuracion.texto.innerHTML = tiempo.toFixed(0) + " s";
}
else
{
if (!this.playerHTML5.controlesNativosVideo)
{
if (tiempo == -1)
this.textoDuracion.texto.innerHTML = tiempoBonito(this.duracion);
else
this.textoDuracion.texto.innerHTML = tiempoBonito(tiempo);
}
}
}
MainController.prototype.onAltavozClick = function() {
this.playerHTML5.controles.volumen.altavoz.className = this.playerHTML5.controles.volumen.altavoz.className.replace(/ playerMPEPV_silencio/g,"");
if (this.playerHTML5.nodoVideo.volume == 0)
{
if (this.adsActive)
this.adsController.setVolume(this.playerHTML5.volumenActual);
this.playerHTML5.setVolume(this.playerHTML5.volumenActual);
this.playerHTML5.datosVideo.isMuted = false;
this.playerHTML5.controles.volumen.onmouseover();
}
else
{
this.playerHTML5.volumenActual = this.playerHTML5.nodoVideo.volume;
this.playerHTML5.controles.volumen.altavoz.className += " playerMPEPV_silencio";
if (this.adsActive)
this.adsController.setVolume(0);
this.playerHTML5.setVolume(0);
this.playerHTML5.datosVideo.isMuted = true;
this.playerHTML5.controles.volumen.onmouseout();
}
};
MainController.prototype.volumenMouseOut = function() {
this.boton = -1;
}
MainController.prototype.setVolume = function(volumen) {
if (volumen <0 || volumen > 1)
return;
if (this.adsActive)
this.adsController.setVolume(volumen);
this.playerHTML5.setVolume(volumen);
};
MainController.prototype.seekjs = function(segundo) {
this.video.currentTime = segundo;
if (!this.playerHTML5.playing)
{
this.playerHTML5.play();
this.adsActive = false;
this.adsDone = true;
this.updateChrome();
}
};
MainController.prototype.seek = function(e) {
var pos = this.duracion * e.layerX  / e.target.offsetWidth;
this.video.currentTime = pos;
if (!this.playerHTML5.playing)
{
this.playerHTML5.play();
this.adsActive = false;
this.adsDone = true;
this.updateChrome();
}
};
MainController.prototype.seekmove = function(e) {
var pos = this.video.duration * e.layerX  / e.target.offsetWidth;
this.time.innerHTML = tiempoBonito(pos);
this.time.style.left = (50 - this.time.offsetWidth / 2) + "px";
};
MainController.prototype.onSliderClick = function(event) {
var volumen = 1-((event.offsetY ? event.offsetY : event.layerY)  / event.target.offsetHeight);
this.setVolume(volumen);
};
MainController.prototype.onSliderMouseMove = function(event) {
if (this.boton != 1)
return;
var volumen = 1-((event.offsetY ? event.offsetY : event.layerY) / event.target.offsetHeight);
this.setVolume(volumen);
};
MainController.prototype.onSliderMouseDown = function(event) {
this.boton = event.buttons ? event.buttons : event.which;
};
MainController.prototype.onSliderMouseUp = function(event) {
this.boton = -1
};
MainController.prototype.onMousewheel = function(event) {
var e = window.event || event;
var delta = e.detail ? event.detail : event.wheelDelta;
delta = delta * factorVolumen;
if (delta > 0)
this.setVolume(this.playerHTML5.nodoVideo.volume + 0.02);
else
this.setVolume(this.playerHTML5.nodoVideo.volume - 0.02);
};
MainController.prototype.onClick = function() {
if (this.playerHTML5.adContainer != null && !this.adsDone)
{
this.adsController.initialUserAction();
this.playerHTML5.preloadContent(this.bind(this, this.loadAds));
this.adsDone = true;
return;
}
if (this.adsActive)
{
if (this.adPlaying)
this.adsController.pause();
else
this.adsController.resume();
this.adPlaying = !this.adPlaying;
}
else
{
if (this.playerHTML5.playing)
this.playerHTML5.pause();
else
this.playerHTML5.play();
}
this.updateChrome();
};
MainController.prototype.onFullscreenClick = function() {
this.playerHTML5.fullscreen();
};
MainController.prototype.updateChrome = function() {
if ( !this.playerHTML5.controles)
return;
var activo = (this.adsActive) ? this.adPlaying : this.playerHTML5.playing;
if (activo)
this.playButton.className = "playerMPEPV_boton_play_pause playerMPEPV_boton_pause";
else
this.playButton.className = "playerMPEPV_boton_play_pause playerMPEPV_boton_play";
};
MainController.prototype.resumeAfterAd = function() {
this.adPlaying = false;
this.adsActive = false;
this.playerHTML5.play();
this.updateChrome();
};
MainController.prototype.pause = function() {
if (this.adPlaying)
this.adsController.pause();
if (this.playerHTML5.playing)
this.playerHTML5.pause();
this.adPlaying = false;
this.updateChrome();
};
MainController.prototype.pauseForAd = function() {
this.adsActive = true;
this.adPlaying = false;
this.playerHTML5.pause();
this.updateChrome();
};
MainController.prototype.startAd = function() {
this.adsActive = true;
this.adPlaying  = true;
this.updateChrome();
};
MainController.prototype.adClicked = function() {
this.adsActive = true;
this.adsController.pause();
this.adPlaying = false;
this.updateChrome();
};
MainController.prototype.loadAds = function() {
this.adsController.requestAds(this.playerHTML5.adTagUrl);
};
MainController.prototype.onAdSkip = function() {
this.playerHTML5.marcado._datosMarcado.ad = this.adsController.adInfo;
this.playerHTML5.marcado._datosMarcado.adCue = this.adsController.adPosition;
this.playerHTML5.marcado._datosMarcado.duracion = this.adsController.duracionAd;
this.playerHTML5.marcado._datosMarcado.adTitle = this.adsController.adTitle;
this.playerHTML5.marcado._datosMarcado.uid = this.playerHTML5.datosVideo.uid;
this.playerHTML5.marcado._datosMarcado.seccion_creacion = this.playerHTML5.datosVideo.seccion_creacion;
this.playerHTML5.marcado._datosMarcado.fuente = this.playerHTML5.datosVideo.fuente;
this.playerHTML5.marcado._datosMarcado.tags = this.playerHTML5.datosVideo.tagsIds;
this.playerHTML5.marcado._datosMarcado.autores = this.playerHTML5.datosVideo.autoresIds;
this.playerHTML5.marcado._datosMarcado.adCurrentTime = this.adsController.currentTime;
this.playerHTML5.marcado.marcaEvento("adSkip");
this.ocultaSaltar();
this.adsController.adSkip();
};
MainController.prototype.muestraSaltar = function()
{
if (this.adSkip)
this.adSkip.style.display = 'block';
}
MainController.prototype.ocultaSaltar = function()
{
if (this.adSkip)
this.adSkip.style.display = 'none';
}
var AdsController = function(controller, player) {
this.controller = controller;
this.player = player;
this.contentCompleteCalled = false;
this.duracionAd = 0;
this.adPosition = "pre-roll";
this.adInfo = "dfp";
this.skippable = false;
this.adComplete = false;
this.currentTime = -1;
this.adDisplayContainer = new google.ima.AdDisplayContainer(this.player.adContainer);
this.adsLoader = new google.ima.AdsLoader(this.adDisplayContainer);
if (this.adsLoader)
{
var settings = this.adsLoader.getSettings();
settings.setNumRedirects(5);
}
this.adsManager = null;
this.adsLoader.addEventListener(
google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,
this.onAdsManagerLoaded,
false,
this);
this.adsLoader.addEventListener(
google.ima.AdErrorEvent.Type.AD_ERROR,
this.onAdError,
false,
this);
};
AdsController.prototype.bind = function(thisObj, fn)
{
return function() {
fn.apply(thisObj, arguments);
};
};
AdsController.prototype.initialUserAction = function() {
this.adDisplayContainer.initialize();
};
AdsController.prototype.requestAds = function(adTagUrl) {
adTagUrl = adTagUrl.replace("{random}", String(Math.random()).substr(2,9));
if (this.adPosition == "pre-roll")
adTagUrl = adTagUrl.replace("{cuePointType}", "pre");
else
adTagUrl = adTagUrl.replace("{cuePointType}", "post");
if (this.adsLoader)
{
this.adsLoader.contentComplete();
}
var adsRequest = new google.ima.AdsRequest();
adsRequest.adTagUrl = adTagUrl;
adsRequest.linearAdSlotWidth = this.player.width;
adsRequest.linearAdSlotHeight = this.player.height;
adsRequest.nonLinearAdSlotWidth = this.player.width;
adsRequest.nonLinearAdSlotHeight = this.player.height;
var adunit = adTagUrl.replace(/^.*iu=/, "");
adunit = unescape(adunit.replace(/\&.*$/, ""));
this.player.marcado._datosMarcado.duracion = 0;
this.player.marcado._datosMarcado.ad = "";
this.player.marcado._datosMarcado.adCue = this.adPosition + "-" + adunit;
this.player.marcado._datosMarcado.adTitle = "";
this.player.marcado._datosMarcado.uid = this.player.datosVideo.uid;
this.player.marcado._datosMarcado.seccion_creacion = this.player.datosVideo.seccion_creacion;
this.player.marcado._datosMarcado.fuente = this.player.datosVideo.fuente;
this.player.marcado._datosMarcado.tags = this.player.datosVideo.tagsIds;
this.player.marcado._datosMarcado.autores = this.player.datosVideo.autoresIds;
this.player.marcado.marcaEvento("adRequest");
this.adsLoader.requestAds(adsRequest);
if (this.adPosition == "pre-roll")
this.timeoutLoadedStarted = setTimeout(this.resumeOnError.bind(this), 4000);
};
AdsController.prototype.onAdsManagerLoaded = function(adsManagerLoadedEvent) {
this.controller.actualizaTiempo(0,true);
this.adsManager = adsManagerLoadedEvent.getAdsManager(
this.player.nodoVideo);
this.processAdsManager(this.adsManager);
if (this.player.datosVideo.isMuted)
this.adsManager.setVolume(0);
};
AdsController.prototype.processAdsManager = function(adsManager) {
adsManager.addEventListener(
google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,
this.onContentPauseRequested,
false,
this);
adsManager.addEventListener(
google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,
this.onContentResumeRequested,
false,
this);
adsManager.addEventListener(
google.ima.AdErrorEvent.Type.AD_ERROR,
this.onAdError,
false,
this);
var events = [google.ima.AdEvent.Type.ALL_ADS_COMPLETED,
google.ima.AdEvent.Type.CLICK,
google.ima.AdEvent.Type.COMPLETE,
google.ima.AdEvent.Type.LOADED,
google.ima.AdEvent.Type.PAUSED,
google.ima.AdEvent.Type.RESUMED,
google.ima.AdEvent.Type.STARTED
];
for (var index in events)
{
adsManager.addEventListener(
events[index],
this.onAdEvent,
false,
this);
}
var initWidth, initHeight;
if (this.controller.fullscreen)
{
initWidth = this.controller.fullscreenWidth;
initHeight = this.controller.fullscreenHeight;
}
else
{
initWidth = this.player.width;
initHeight = this.player.height;
}
adsManager.init(
initWidth,
initHeight,
google.ima.ViewMode.NORMAL);
adsManager.start();
};
AdsController.prototype.pause = function() {
if (this.adsManager)
this.adsManager.pause();
clearInterval(this.intervalTimmer);
};
AdsController.prototype.resume = function() {
if (this.adsManager) {
this.adsManager.resume();
}
};
AdsController.prototype.setVolume = function(volumen) {
if (this.adsManager)
{
this.adsManager.setVolume(volumen);
this.player.actualizaVolumen();
}
};
AdsController.prototype.onContentPauseRequested = function() {
this.controller.pauseForAd();
};
AdsController.prototype.onContentResumeRequested = function() {
if (this.adPosition == 'post-roll')
return;
clearInterval(this.intervalTimmer);
if (!this.contentCompleteCalled)
this.controller.resumeAfterAd();
};
AdsController.prototype.onAdEvent = function(adEvent) {
switch (adEvent.type)
{
case google.ima.AdEvent.Type.CLICK:
clearInterval(this.intervalTimmer);
this.controller.adClicked();
break;
case google.ima.AdEvent.Type.STARTED:
clearTimeout(this.timeoutLoadedStarted);
var ad = adEvent.getAd();
if (ad.isLinear())
{
if (this.player.adContainer != null)
{
this.player.adContainer.style.display = 'block';
if (this.player.controles)
{
this.player.controles.barra.style.visibility = 'hidden';
this.player.controles.tiempo.style.width = this.player.controles.tiempo.offsetWidth + "px";
this.player.controles.fullscreen.style.visibility = 'hidden';
this.player.controles.tiempo.texto.innerHTML = (LANG_MSG[LANG].publicidad).toUpperCase();
if (isIpad)
this.player.controles.volumen.style.visibility = 'hidden';
}
if (dispositivoMovil || this.player.controlesNativosVideo)
{
this.player.contenedorVideo.className = this.player.contenedorVideo.className.replace(/ playerMPEPV_touch_\w*/g,"");
this.player.contenedorVideo.className += " playerMPEPV_touch_publicidad";
this.player.nodoVideo.removeAttribute("controls");
}
this.controller.startAd();
MultimediaReproduciendo(this.player.datosVideo.id_video, false);
this.duracionAd = -2;
this.adComplete = false;
this.intervalTimmer = setInterval( this.onProgress.bind(this), 300);
}
}
break;
case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:
this.player.nodoVideo.style.display = 'block';
if (this.player.controles)
{
this.player.controles.style.visibility = 'visible';
this.player.controles.barra.style.visibility = 'visible';
this.player.controles.fullscreen.style.visibility = 'visible';
this.player.controles.tiempo.texto.innerHTML = '00:00';
}
this.player.adContainer.style.display = 'none';
this.controller.adPlaying = false;
this.controller.adsActive = false;
this.controller.actualizaTiempo(-1);
this.controller.ocultaSaltar()
if (this.adComplete)
{
this.adComplete = false;
this.player.marcado._datosMarcado.duracion = this.duracionAd;
this.player.marcado._datosMarcado.ad = this.adInfo;
this.player.marcado._datosMarcado.adCue = this.adPosition;
this.player.marcado._datosMarcado.adTitle = this.adTitle;
this.player.marcado._datosMarcado.uid = this.player.datosVideo.uid;
this.player.marcado._datosMarcado.seccion_creacion = this.player.datosVideo.seccion_creacion;
this.player.marcado._datosMarcado.fuente = this.player.datosVideo.fuente;
this.player.marcado._datosMarcado.tags = this.player.datosVideo.tagsIds;
this.player.marcado._datosMarcado.autores = this.player.datosVideo.autoresIds;
this.player.marcado._datosMarcado.adCurrentTime = this.duracionAd;
this.player.marcado.marcaEvento("adComplete");
}
else
{
this.controller.onAdSkip();
}
if (this.adPosition == "post-roll")
{
this.adPosition = 'pre-roll';
this.controller.restart();
}
clearInterval(this.intervalTimmer);
if (dispositivoMovil || this.player.controlesNativosVideo)
{
this.player.contenedorVideo.className = this.player.contenedorVideo.className.replace(/ playerMPEPV_touch[\w_]*/g,"");
this.player.contenedorVideo.className += " playerMPEPV_touch";
this.player.nodoVideo.setAttribute ( "controls" , "controls" );
}
break;
case google.ima.AdEvent.Type.PAUSED:
clearInterval(this.intervalTimmer);
this.player.marcado._datosMarcado.adCurrentTime = this.currentTime;
this.player.marcado.marcaComscore("adPaused");
break;
case google.ima.AdEvent.Type.RESUMED:
this.intervalTimmer = setInterval( this.onProgress.bind(this), 300);
MultimediaReproduciendo(this.player.datosVideo.id_video, false);
this.player.marcado._datosMarcado.adCurrentTime = this.currentTime;
this.player.marcado.marcaComscore("adResumed");
break;
case google.ima.AdEvent.Type.LOADED:
clearTimeout(this.timeoutLoadedStarted);
var ad = adEvent.getAd();
if (typeof(ad.isSkippable()) != "undefined" && ad.isSkippable())
this.skippable = true;
this.adTitle = ad.getAdId() + " - " + ad.getTitle();
if (!ad.isLinear()) {
this.controller.resumeAfterAd();
return;
}
if (ad.getWrapperAdIds().length == 0)
this.adInfo = "dfp";
else
this.adInfo = "tercero";
if (this.player.controles && this.player.controles.thumbnails)
this.player.controles.thumbnails.style.visibility = "hidden";
break;
}
};
AdsController.prototype.resumeOnError = function()
{
if (this.adsManager)
this.adsManager.stop();
else
this.onContentResumeRequested();
}
AdsController.prototype.onProgress = function()
{
if (this.adsManager.getRemainingTime() <= 0)
return;
if (!this.controller.adPlaying || this.duracionAd <= 1 || this.duracionAd >99 )
{
this.duracionAd = this.adsManager.getRemainingTime();
if (this.player.controles)
this.player.controles.style.visibility = 'visible';
this.player.marcado._datosMarcado.duracion = this.duracionAd;
this.player.marcado._datosMarcado.ad = this.adInfo;
this.player.marcado._datosMarcado.adCue = this.adPosition;
this.player.marcado._datosMarcado.adTitle = this.adTitle;
this.player.marcado._datosMarcado.uid = this.player.datosVideo.uid;
this.player.marcado._datosMarcado.seccion_creacion = this.player.datosVideo.seccion_creacion;
this.player.marcado._datosMarcado.fuente = this.player.datosVideo.fuente;
this.player.marcado._datosMarcado.tags = this.player.datosVideo.tagsIds;
this.player.marcado._datosMarcado.autores = this.player.datosVideo.autoresIds;
this.player.marcado._datosMarcado.adCurrentTime = 0;
this.player.marcado.marcaEvento("adStart");
return;
}
this.currentTime = this.duracionAd - this.adsManager.getRemainingTime();
if (this.adPosition == "pre-roll" )
{
if (!isIphone && !this.skippable && this.adsManager.getRemainingTime() > 2 && this.adsManager.getRemainingTime() < this.duracionAd - 7)
{
this.controller.muestraSaltar();
}
if (isIphone  && this.adsManager.getRemainingTime() < this.duracionAd - 21)
{
clearInterval(this.intervalTimmer);
this.adsManager.stop();
}
}
if (!isIphone && this.adsManager.getRemainingTime() > 1)
this.controller.actualizaTiempo(this.adsManager.getRemainingTime(), true);
if (this.adsManager.getRemainingTime() < 0.5)
this.adComplete = true;
};
AdsController.prototype.onAdError = function(adErrorEvent) {
var adError = adErrorEvent.getError();
this.player.marcado._datosMarcado.adCue = this.adPosition;
this.player.marcado._datosMarcado.ad = this.adInfo;
this.player.marcado._datosMarcado.uid = this.player.datosVideo.uid;
this.player.marcado._datosMarcado.seccion_creacion = this.player.datosVideo.seccion_creacion;
this.player.marcado._datosMarcado.fuente = this.player.datosVideo.fuente;
this.player.marcado._datosMarcado.adCurrentTime = -1;
this.player.marcado._datosMarcado.adTitle = (this.adTitle ? this.adTitle : "error ad_load")+ ":-:" + adError.getErrorCode() + (adError.getErrorCode() != adError.getVastErrorCode() ? ("-" + adError.getVastErrorCode() ): "");
this.player.marcado.marcaEvento("adError");
this.player.nodoVideo.style.display = 'block';
if (this.player.controles)
this.player.controles.style.visibility = 'visible';
this.player.adContainer.style.display = 'none';
if (dispositivoMovil || this.player.controlesNativosVideo)
{
this.player.contenedorVideo.className = this.player.contenedorVideo.className.replace(/ playerMPEPV_touch[\w_]+/g,"");
this.player.contenedorVideo.className += " playerMPEPV_touch";
this.player.nodoVideo.setAttribute ( "controls" , "controls" );
}
if (this.adPosition == 'post-roll')
{
this.adPosition = 'pre-roll';
this.controller.restart();
}
else
{
clearTimeout(this.timeoutLoadedStarted);
this.controller.resumeAfterAd();
}
if (this.adsManager) {
this.adsManager.destroy();
}
this.controller.adPlaying = false;
this.controller.adsActive = false;
};
AdsController.prototype.resize = function(width, height) {
if (this.adsManager)
this.adsManager.resize(width, height, google.ima.ViewMode.FULLSCREEN);
};
AdsController.prototype.contentEnded = function() {
if (!dispositivoMovil)
{
this.adPosition = 'post-roll';
this.contentCompleteCalled = true;
this.controller.adsActive = false;
this.duracionAd = -2;
this.controller.onClick();
}
else
this.controller.restart();
};
AdsController.prototype.adSkip = function() {
clearInterval(this.intervalTimmer);
this.adsManager.stop();
this.controller.adsActive = false;
this.controller.adPlaying = false;
};
function VDPEP_Player_Cartelera(refVideo, ancho, alto, idDiv, publi, keywords, fotograma, urlNoticia, genero)
{
id_div_ReproductorVideo = idDiv;
datosVideo = {};
datosVideo.playerEPETParams = {"mediaWidth":ancho, "mediaHeight":alto, "URLMediaFile":"", "URLMediaStill":fotograma, "URLFirstFrame":fotograma, "compactMode": 'false'};
datosVideo.anchoPlayer = ancho;
datosVideo.altoPlayer = alto;
datosVideo.idRefBrightcove = refVideo.replace(/_0$/,"");
datosVideo.publiActiva = publi;
datosVideo.keywordsVideo = keywords;
datosVideo.urlNoticia = "";
datosVideo.tituloVideo = "";
var video = new EPET_Video(datosVideo, id_div_ReproductorVideo);
}
function EPET_VideoPlayerGeobloqueado(idReferencia, ancho, alto, fotograma, idDivContenedor)
{
EPET_VideoPlayerBloqueado(idReferencia, ancho, alto, fotograma, '0', idDivContenedor);
}
function EPET_VideoPlayerBloqueado(idReferencia, ancho, alto, fotograma, causaBloqueo, idDivContenedor, esAudio)
{
if ( !css_multimedia_cargado)
{
css_multimedia_cargado = true;
var css = document.createElement("link");
css.type = "text/css";
css.rel = "stylesheet";
css.href = css_multimedia;
document.getElementsByTagName("head")[0].appendChild(css);
}
var id_div_ReproductorVideo;
var idImage = "img_" + idReferencia;
var texto_error;
switch(String(causaBloqueo)) {
case "0":
texto_error = esAudio ? LANG_MSG[LANG].audio_geobloqueado : LANG_MSG[LANG].geobloqueado;
break;
case "1":
texto_error = esAudio ? LANG_MSG[LANG].audio_aun_no_disponible : LANG_MSG[LANG].aun_no_disponible;
break;
case "2":
texto_error = esAudio ? LANG_MSG[LANG].audio_no_disponible : LANG_MSG[LANG].no_disponible;
break;
case "3":
texto_error = LANG_MSG[LANG].actualizar_plugin;
break;
case "4":
texto_error = LANG_MSG[LANG].bloqueado;
break;
case "-1":
case "-2":
texto_error = esAudio ? LANG_MSG[LANG].audio_no_encontrado : LANG_MSG[LANG].no_encontrado;
break;
default :
texto_error = " Error Cod. " + String(causaBloqueo);
break;
}
if (typeof(idDivContenedor) == "undefined" )
{
id_div_ReproductorVideo = "VideoPlayer_" + String(Math.random()).substr(2,9);
document.write('<div id="' + id_div_ReproductorVideo + '"></div>');
}
else
id_div_ReproductorVideo = idDivContenedor;
if (typeof(SiguientesVideosPEP._id) != "undefined" && SiguientesVideosPEP._id != "" && document.getElementById(SiguientesVideosPEP._id))
{
document.getElementById(SiguientesVideosPEP._id).style.paddingTop = "0px";
document.getElementById(SiguientesVideosPEP._id).style.marginLeft = "0px";
}
if (versionMovil || MPEP_responsive)
{
document.getElementById(id_div_ReproductorVideo).innerHTML = '<div class="video_previa video_no_disponible" id="' + idImage +
'"><div class="fondo_mensaje_video" ><span>'+texto_error+'</span></div><img src="' +
fotograma + '" style="height:auto;width:100%"/></div>';
}
else
{
document.getElementById(id_div_ReproductorVideo).innerHTML = '<div class="video_previa video_no_disponible" id="' + idImage +
'"><div class="fondo_mensaje_video" ><span>'+texto_error+'</span></div><img src="' +
fotograma + '" width="' + ancho + '" height="' + alto + '" style="height:' + alto + 'px;width:' + ancho + 'px"/></div>';
}
}
function EPET_MultimediaPlayer(player, MP_params, flash_params, flash_width, flash_height, idDivContenedor, idObject, autoplay)
{
var id_div_ReproductorVideo;
if (typeof(idDivContenedor) == "undefined" )
{
id_div_ReproductorVideo = "VideoPlayer_" + String(Math.random()).substr(2,9);
document.write('<div id="' + id_div_ReproductorVideo + '"></div>');
}
else
id_div_ReproductorVideo = idDivContenedor;
var datosVideo = {};
datosVideo.playerEPETParams = {"mediaWidth":flash_width, "mediaHeight":flash_height, "URLMediaFile":MP_params.URLMediaFile, "URLMediaStill":MP_params.URLMediaStill, "URLFirstFrame":"", "compactMode": 'false'};
datosVideo.anchoPlayer = flash_width;
datosVideo.altoPlayer = flash_height;
datosVideo.idRefBrightcove = idObject;
datosVideo.publiActiva = false;
datosVideo.keywordsVideo = "";
datosVideo.urlNoticia = "";
datosVideo.tituloVideo = "";
datosVideo.autoplay = (typeof(autoplay) != "undefined" && autoplay) ? autoplay : false;
var video = new EPET_Video(datosVideo, id_div_ReproductorVideo);
}
function EPET_VideoPlayerBrightcoveExterno(ancho, alto, idVideo, playerKey )
{
var idDiv = "div_" + idVideo;
document.write('<div id="' + idDiv + '"></div>');
var bcParams = {};
bcParams.playerKey = playerKey;
bcParams.isVid = "true";
bcParams.isUI = "true";
bcParams.dynamicStreaming = "true";
bcParams.width =  ancho ;
bcParams.height = alto;
bcParams.bgcolor = "#000000";
bcParams.autoStart = "false";
bcParams.videoSmoothing = "true";
bcParams.forceHTML = "true";
var idIframe = "Iframe_" + idVideo;
var codigoHTML = '<html>\n<head><style type="text/css"> body { margin: 0px;}</style>\n' +
'<script language="JavaScript" type="text/javascript" src="//admin.brightcove.com/js/BrightcoveExperiences.js"></scr' + 'ipt>\n<\head>\n' +
'<body>\n'+
'<object id="Video_' + idVideo + '" class="BrightcoveExperience">\n';
for(var p in bcParams)
{
codigoHTML += '<param name="' + p + '" value="' + bcParams[p] + '" />\n';
}
codigoHTML += '<param name="@videoPlayer" value="' + idVideo + '" />\n';
codigoHTML += '</object>\n' +
'</body>\n</html>\n';
EPETCreaIframe(idIframe, bcParams.width, bcParams.height, "no", 0, idDiv, codigoHTML);
}
function tiempoBonito(tiempo)
{
if ( tiempo == -1 )
return("--:--")
else
if (tiempo == 0)
return("00:00")
tiempo = parseInt(tiempo);
var horas = parseInt ( tiempo / 3600 );
var minutos = parseInt ( (tiempo - horas * 3600) / 60 );
var segundos = tiempo - horas * 3600 - minutos * 60;
if ( minutos < 10 ) minutos = "0" + minutos;
if ( segundos < 10 ) segundos = "0" + segundos;
if (tiempo > 3599)
return horas+":"+minutos+":"+segundos;
else
return minutos+":"+segundos;
};
var mouseWheelEvent;
var factorVolumen;
if (/Firefox/i.test(navigator.userAgent))
{
mouseWheelEvent =  "DOMMouseScroll";
factorVolumen = -1;
}
else
{
mouseWheelEvent =  "mousewheel";
factorVolumen = 1;
}
function wheel(event) {
if (typeof(event.target) != "undefined" && typeof(event.target.id) != "undefined" && event.target.id == "vdpep_audio" )
{
event.preventDefault();
event.stopPropagation();
}
}
function EPETUtils_calcPosition(obj, attr) {
var val=0;
while (obj) {
val+=obj[attr];
obj=obj.offsetParent
}
return val
}
function EPETUtils_calcAbsPosition(el) {
if (document.documentElement.getBoundingClientRect && el.getBoundingClientRect) {
var box = el.getBoundingClientRect();
var rootNode;
if (el.ownerDocument) {
rootNode = el.ownerDocument;
} else {
rootNode = document;
}
return [box.left + Math.max(rootNode.documentElement.scrollLeft, rootNode.body.scrollLeft),
box.top + Math.max(rootNode.documentElement.scrollTop, rootNode.body.scrollTop)];
} else {
var pos = [el.offsetLeft, el.offsetTop];
var parentNode = el.offsetParent;
var accountForBody = (isSafari &&
el.style.position == 'absolute' &&
el.offsetParent == el.ownerDocument.body);
if (parentNode != el) {
while (parentNode) {
pos[0] += parentNode.offsetLeft;
pos[1] += parentNode.offsetTop;
if (!accountForBody && isSafari &&
parentNode.style.position == 'absolute' ) {
accountForBody = true;
}
parentNode = parentNode.offsetParent;
}
}
if (accountForBody) {
pos[0] -= el.ownerDocument.body.offsetLeft;
pos[1] -= el.ownerDocument.body.offsetTop;
}
if (el.parentNode) {
parentNode = el.parentNode;
var ROOT_TAG = /^body|html$/i;
while ( parentNode.tagName && !ROOT_TAG.test(parentNode.tagName) ) {
if (parentNode.style.display.search(/^inline|table-row.*$/i)) {
pos[0] -= parentNode.scrollLeft;
pos[1] -= parentNode.scrollTop;
}
parentNode = parentNode.parentNode;
}
}
return pos;
}
}
function EPETUtils_calcAbsPositionV2(el) {
if (document["documentElement"]["getBoundingClientRect"]) {
var scrollLeft, scrollTop, box, doc,
off1, off2, mode, bLeft, bTop,
xy = false;
if (el.style.display != 'none' && el["getBoundingClientRect"]) {
try {
box = el["getBoundingClientRect"]();
} catch (e) {
return ([0,0]);
}
doc = el["ownerDocument"];
scrollLeft = Math.max(doc["documentElement"].scrollLeft, doc.body.scrollLeft);
scrollTop  = Math.max(doc["documentElement"].scrollTop, doc.body.scrollTop);
xy = [Math.round(box["left"]), Math.round(box["top"])];
if (isIE && isIE < 8) {
off1 = 2;
off2 = 2;
mode = doc["compatMode"];
if (window["getComputedStyle"]) {
bLeft = doc["documentElement"]["defaultView"]["getComputedStyle"](doc["documentElement"], null)["borderLeftWidth"];
bTop  = doc["documentElement"]["defaultView"]["getComputedStyle"](doc["documentElement"], null)["borderTopWidth"];
} else if (doc["documentElement"]["currentStyle"]) {
bLeft = doc["documentElement"]["clientLeft"];
bTop  = doc["documentElement"]["clientTop"];
}
if (isIE == 6) {
if (mode != "BackCompat" && mode != "CSS1Compat") {
off1 = 0;
off2 = 0;
}
}
if ((mode == "BackCompat" || mode == "CSS1Compat")) {
if (bLeft != "medium") {
off1 = parseInt(bLeft, 10);
}
if (bTop != "medium") {
off2 = parseInt(bTop, 10);
}
}
xy[0] -= off1;
xy[1] -= off2;
}
if ((scrollTop || scrollLeft)) {
xy[0] += scrollLeft;
xy[1] += scrollTop;
}
xy[0] = Math.round(xy[0]);
xy[1] = Math.round(xy[1]);
} else {
xy = [0,0];
}
return xy;
} else {
var doc, docScrollLeft, docScrollTop,
scrollTop, scrollLeft,
bCheck,
xy = false,
parentNode = el;
if (el.style.display != 'none') {
xy = [el["offsetLeft"], el["offsetTop"]];
doc = el["ownerDocument"];
docScrollLeft = Math.max(doc["documentElement"].scrollLeft, doc.body.scrollLeft);
docScrollTop = Math.max(doc["documentElement"].scrollTop, doc.body.scrollTop);
bCheck = ((isGecko || isSafari > 519) ? true : false);
while ((parentNode = parentNode["offsetParent"])) {
xy[0] += parentNode["offsetLeft"];
xy[1] += parentNode["offsetTop"];
if (bCheck) {
var t = 0, l = 0;
if (window["getComputedStyle"]) {
t = parseInt(parentNode["ownerDocument"]["defaultView"]["getComputedStyle"](parentNode, null)["borderTopWidth"], 10) || 0;
l = parseInt(parentNode["ownerDocument"]["defaultView"]["getComputedStyle"](parentNode, null)["borderLeftWidth"], 10) || 0;
} else if (parentNode["currentStyle"]) {
t = parseInt(parentNode["clientTop"], 10) || 0;
l = parseInt(parentNode["clientLeft"], 10) || 0;
}
if (isGecko) {
if (/^t(?:able|d|h)$/i.test(parentNode["tagName"])) {
t = 0;
l = 0;
}
}
xy[0] += l;
xy[1] += t;
}
}
if (el.style.position != "fixed") {
parentNode = el;
while ((parentNode = parentNode["parentNode"]) && parentNode["tagName"]) {
scrollTop = parentNode["scrollTop"];
scrollLeft = parentNode["scrollLeft"];
if (scrollTop || scrollLeft) {
xy[0] -= scrollLeft;
xy[1] -= scrollTop;
}
}
xy[0] += docScrollLeft;
xy[1] += docScrollTop;
} else {
if (isOpera) {
xy[0] -= docScrollLeft;
xy[1] -= docScrollTop;
} else if (isSafari || isGecko) {
xy[0] += docScrollLeft;
xy[1] += docScrollTop;
}
}
xy[0] = Math.round(xy[0]);
xy[1] = Math.round(xy[1]);
} else {
xy[0] = 0;
xy[1] = 0;
}
}
return xy;
}
function EPETUtils_posicionarScrollEnPagina(posY) {
if (typeof document.documentElement.scrollTop != "undefined") {
document.documentElement.scrollTop = parseInt(posY);
}
if (typeof document.body.scrollTop != "undefined" && !isOpera) {
document.body.scrollTop = parseInt(posY);
}
}
function EPETUtils_windowOpen(url, nombreVentana, attrs) {
var nuevoNombre = nombreVentana;
if (nuevoNombre == '') {
nuevoNombre = Math.random();
}
var _window = window.open(url, nombreVentana, attrs);
}
function EPETUtils_IFrameRequest() {
var reqCount = 0;
this.readyState = 0;
this.status = 0;
this.responseText = "";
reqCount++;
this.req_id = reqCount;
}
EPETUtils_IFrameRequest.prototype = {
open: function(protocol, url, async) {
this.protocol = protocol;
this.url      = url;
},
onreadystatechange: function() { },
send: function(postBody) {
var self = this;
if (this.protocol.toUpperCase()=='POST') {
this.url = this.url + "&" + postBody;
}
var IFrameDoc = document.createElement('iframe');
IFrameDoc.setAttribute('id', 'req'+this.req_id);
IFrameDoc.setAttribute('name', 'req'+this.req_id);
IFrameDoc.style.width = "0";IFrameDoc.style.height = "0";IFrameDoc.style.border = "0";
document.body.appendChild(IFrameDoc);
try {
IFrameDoc.src = this.url;
}catch(e){
return false;
}
this.readyState = 1; this.onreadystatechange();
setTimeout(function(){self.IFht(4);}, 4);
},
overrideMimeType: function() { },
getResponseHeader: function (name) { return ''; },
setRequestHeader: function (name, data) { },
IFht: function (d) {
var self=this;
var el=document.getElementById('req'+self.req_id);
if (el.readyState=='complete') {
self.responseText = document.frames['req'+self.req_id].document.body.innerHTML.replace(/[\n\r]+/ig, "");
el.parentNode.removeChild(el);
self.status = 200;
self.readyState = 4;
self.onreadystatechange();
}else{
d*=1.5;
setTimeout(function(){self.IFht(d);},d);
}
}
};
function EPETUtils_makeHttpRequest(callbackFunction, url, postData, contentType) {
if (typeof contentType =="undefined") { contentType = 'application/x-www-form-urlencoded'; }
var EPETUtils_xmlHttpRequest = EPETUtils_createHttpRequestObj(contentType);
if (!EPETUtils_xmlHttpRequest) return;
EPETUtils_xmlHttpRequest.onreadystatechange = function () {
if (EPETUtils_xmlHttpRequest.readyState != 4) return;
callbackFunction(EPETUtils_xmlHttpRequest);
}
EPETUtils_xmlHttpRequest.open('POST', url, true);
EPETUtils_xmlHttpRequest.setRequestHeader('Content-type', contentType);
EPETUtils_xmlHttpRequest.send(postData);
}
function EPETUtils_makeHttpRequestGet (callbackFunction, url, contentType) {
if (typeof contentType =="undefined" ) { contentType = 'application/x-www-form-urlencoded'; }
var EPETUtils_xmlHttpRequest = EPETUtils_createHttpRequestObj(contentType);
if (!EPETUtils_xmlHttpRequest) return;
EPETUtils_xmlHttpRequest.onreadystatechange = function () {
if (EPETUtils_xmlHttpRequest.readyState != 4) return;
callbackFunction(EPETUtils_xmlHttpRequest);
}
EPETUtils_xmlHttpRequest.open('GET', url, true);
EPETUtils_xmlHttpRequest.setRequestHeader('Content-type', contentType);
EPETUtils_xmlHttpRequest.send(null);
}
function EPETUtils_createHttpRequestObj(contentType) {
var httpRequest;
if (window.XMLHttpRequest) {
httpRequest = new XMLHttpRequest();
if (httpRequest.overrideMimeType && contentType) {
httpRequest.overrideMimeType(contentType);
}
}else if (window.ActiveXObject) {
try {
httpRequest = new ActiveXObject("Msxml2.XMLHTTP");
}
catch (e) {
try {
httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
}
catch (e) {
try {
httpRequest = new EPETUtils_IFrameRequest();
}
catch (e) {
httpRequest = false;
}
}
}
}
return httpRequest;
}
function marcadoAmpliaFoto(tituloPagina, fotoUrl)
{
if (typeof(launchAjaxOMN) == "function")
{
tituloPagina = tituloPagina.replace(/'|"|\|/g, "");
launchAjaxOMN("39|46", tituloPagina + "|" + fotoUrl, "event76");
}
}
function EPETtrackNewInfoFromAJAX()
{
var rndPXLAJAX = parseInt(Math.random()*10000000);
var imgMMDAJAX = new Image(1,1);
imgMMDAJAX.src = "/pxlctl.gif?"+rndPXLAJAX;
if (typeof(launchAjaxOMN) == "function" && typeof(omnEvars) != "undefined" && typeof(omnInfo) != "undefined" &&  typeof(omnEvents) != "undefined" )
{
launchAjaxOMN(omnEvars, omnInfo, omnEvents);
}
}
function EPETtrackWidgetNewInfoFromAJAX()
{
var rndPXLAJAX = parseInt(Math.random()*10000000);
var imgMMDAJAX = new Image(1,1);
imgMMDAJAX.src = "/pxlctl.gif?"+rndPXLAJAX;
}

function EPETCreaIframe(id, ancho, alto, scroll, borde, div, code)
{
var iframe=document.createElement("iframe");
iframe.setAttribute("id",id);
iframe.setAttribute("width",ancho);
iframe.setAttribute("height",alto);
iframe.setAttribute("scrolling", scroll);
iframe.frameBorder = borde;
document.getElementById(div).innerHTML = "";
document.getElementById(div).appendChild(iframe);
iFrDoc = document.getElementById(id).contentWindow.document || document.getElementById(id).contentDocument.document;
iFrDoc.write(code);
iFrDoc.close();
}

function EPETaddClass(id, name) {
var obj;
if ( typeof(id) == 'string' ) {
if ( document.getElementById(id) ) {
obj = document.getElementById(id);
} else {
return true;
}
} else if ( typeof(id) == 'object' ) {
obj = id;
} else {
return true;
}
var estilo = obj.className;
estilo += ' ' + name;
obj.className = estilo;
}
function EPETremoveClass(id, name) {
var obj;
if ( typeof(id) == 'string' ) {
if ( document.getElementById(id) ) {
obj = document.getElementById(id);
} else {
return true;
}
} else if ( typeof(id) == 'object' ) {
obj = id;
} else {
return true;
}
var estilo = obj.className;
var Exp = new RegExp('\\s*'+name+'(\\s|$)','g');
estilo = estilo.replace(Exp, ' ');
obj.className = estilo;
}
function EPETUtils_userSelectOff() {
if (isGecko) { document.body.style.MozUserSelect = "none"; }
if (isSafari) { document.body.style.KhtmlUserSelect = "none"; }
if (isIE) { document.body.unselectable = "on"; }
document.body.style.userSelect = "none";
}
function EPETUtils_userSelectOn() {
if (isGecko) { document.body.style.MozUserSelect = "text"; }
if (isSafari) { document.body.style.KhtmlUserSelect = "text"; }
if (isIE) { document.body.unselectable = "off"; }
document.body.style.userSelect = "text";
}
function EPETUtils_fullEncodeURIComponent(str) {
str = encodeURIComponent(str)
return (str.replace(/'/g, "%27"));
}
function EPETnewsNotify() {
EPETUtils_makeHttpRequestGet ( function() { return true; }, '/notificarelacionadas', '');
}
function EPETgetVScrollPosition()
{
if (typeof(document.documentElement.scrollTop) != "undefined" && document.documentElement.scrollTop)
return document.documentElement.scrollTop;
else
if (typeof(window.pageYOffset) != "undefined")
return window.pageYOffset;
else
return 0;
}

function EPETBrowserDims()
{
var viewportwidth = 0;
var viewportheight = 0;
if (typeof window.innerWidth != 'undefined') {
viewportwidth = window.innerWidth,
viewportheight = window.innerHeight
}
else if (typeof document.documentElement != 'undefined'
&& typeof document.documentElement.clientWidth !=
'undefined' && document.documentElement.clientWidth != 0) {
viewportwidth = document.documentElement.clientWidth,
viewportheight = document.documentElement.clientHeight
}
else {
viewportwidth = document.getElementsByTagName('body')[0].clientWidth,
viewportheight = document.getElementsByTagName('body')[0].clientHeight
}
if (dispositivoMovil && typeof document.documentElement != 'undefined' && typeof document.documentElement.clientWidth != 'undefined' && document.documentElement.clientWidth != 0)
{
viewportwidth = document.documentElement.clientWidth;
viewportheight = document.documentElement.clientHeight;
}
return {"ancho" : viewportwidth , "alto" : viewportheight};
}
function EPETalternacampos(id_campo1, estilo_campo1, id_campo2, estilo_campo2) {
if (document.getElementById(id_campo1)) {
document.getElementById(id_campo1).style.display = estilo_campo1;
}
if (document.getElementById(id_campo2)) {
document.getElementById(id_campo2).style.display = estilo_campo2;
}
}
function teclaPulsada(key)
{
var keycode;
if (window.event)
keycode = window.event.keyCode;
else
if (key)
keycode = key.which;
if (keycode == 27)
cerrarTelonMultimedia();
}
function teclaTelonEvent(e)
{
if (e.keyCode == 27 ){
cerrarTelonMultimedia();
}
}
var htmlCapaCentral = '<img id="imagen_contenedor" src="/t.gif" width="" height="" alt="' + LANG_MSG[LANG].foto + '"/><p id="pie_contenedor" class="figcaption estirar"></p>';
var htmlCapaFlotante = '<div id="flotante_foto" class="flotante_foto">\n' +
'        <div class="contenedor_foto estirar">\n' +
'            <a title="' + LANG_MSG[LANG].cerrar + '" href="javascript:void(0);" id="id_cerrar_arriba" class="cerrar" onClick="javascript:cerrarTelonMultimedia()">' + LANG_MSG[LANG].cerrar + '</a>\n' +
'			 <a id="ampliar" style="display:none" class="boton ampliar" href="javascript:void(0);">' + LANG_MSG[LANG].tamanio_real + '</a>\n' +
'            <div id="contenedor_central_telon" class="foto figure">' + htmlCapaCentral + '</div>' +
'        </div>\n' +
'</div>\n';
var fotoTamanioReal = false;
function bloqueaClick(e)
{
if (!e) var e = window.event;
e.cancelBubble = true;
if (e.stopPropagation) e.stopPropagation();
}
function crearTelonMultimedia()
{
if (document.getElementById("id_telon"))
document.getElementById("id_telon").parentNode.removeChild(document.getElementById("id_telon"));
if (document.getElementById("id_contenedorCapaFlotante"))
document.getElementById("id_contenedorCapaFlotante").parentNode.removeChild(document.getElementById("id_contenedorCapaFlotante"));
var telon = document.createElement('div');
telon.id = 'id_telon';
telon.style.display = 'none';
telon.className = 'telon';
telon.onclick = function() { cerrarTelonMultimedia();};
document.body.appendChild(telon);
var contenedor = document.createElement('div');
contenedor.id = 'id_contenedorCapaFlotante';
contenedor.style.top = '0px';
contenedor.style.left = '0px';
contenedor.style.display = 'none';
contenedor.className = 'contenedor_capa_flotante';
contenedor.onclick = function() { cerrarTelonMultimedia();};
contenedor.innerHTML = htmlCapaFlotante;
document.body.appendChild(contenedor);
}
function cerrarTelonMultimedia()
{
if (document.getElementById("id_telon").style.display != "none")
{
EPETalternacampos('id_telon', 'none', 'id_contenedorCapaFlotante', 'none');
var nodoCentral = document.getElementById("contenedor_central_telon");
if (nodoCentral)
nodoCentral.innerHTML =  htmlCapaCentral;
if (window.addEventListener)
window.removeEventListener('keydown', teclaTelonEvent,true);
else
document.onkeydown = null;
}
}
function ampliaFoto(boton, url_foto, ancho_foto, alto_foto, pie_foto)
{
var nodoCentral = document.getElementById("contenedor_central_telon");
if (!nodoCentral)
crearTelonMultimedia();
setTimeout(function() {
if (ancho_foto > 0 && alto_foto > 0)
{
setTimeout(function(){
ampliaFotoCallback(boton, url_foto, ancho_foto, alto_foto, pie_foto);
}, 100);
}
else
{
var oculto = document.createElement('div');
oculto.style.width = '0px';
oculto.style.height = '0px';
oculto.style.overflow = 'hidden';
document.body.appendChild(oculto);
var oImg=document.createElement("img");
oImg.onload = function() { ampliaFotoCallback(boton, url_foto, (this.naturalWidth != undefined ? this.naturalWidth : this.offsetWidth), (this.naturalHeight != undefined ? this.naturalHeight : this.offsetHeight), pie_foto); oculto.parentNode.removeChild(oculto) };
oImg.setAttribute('src', url_foto + "?" + Math.random());
oculto.appendChild(oImg);
}
}, 100);
}
function ampliaFotoCallback(boton, url_foto, ancho_foto, alto_foto, pie_foto)
{
var telon = document.getElementById('id_telon');
var capaFlotante = document.getElementById('id_contenedorCapaFlotante');
document.getElementById('ampliar').className = 'boton ampliar';
document.getElementById('ampliar').innerHTML= LANG_MSG[LANG].tamanio_real;
fotoTamanioReal = false;
var altoPie = 0 ;
if (telon != undefined  && capaFlotante != undefined )
{
pie_foto = pie_foto.replace(new RegExp("\&amp;", "gm"), "&");
pie_foto = pie_foto.replace(new RegExp("\&lt;", "gm"), "<");
pie_foto = pie_foto.replace(new RegExp("\&gt;", "gm"), ">");
document.getElementById('pie_contenedor').onclick = bloqueaClick;
document.getElementById('pie_contenedor').innerHTML = pie_foto;
EPETalternacampos('id_telon','block', 'id_contenedorCapaFlotante','block');
if (dispositivoMovil)
{
var altoBody = document.body.scrollHeight;
telon.style.position = 'absolute';
telon.style.height = altoBody + 'px';
telon.style.width = dimensionesPEP.ancho + 'px';
capaFlotante.style.position = 'absolute';
}
else
{
capaFlotante.style.position = 'fixed';
telon.style.position = 'fixed';
}
altoPie = document.getElementById('pie_contenedor').offsetHeight;
var YscrollVertical = EPETgetVScrollPosition();
var altoBloqueCentral = parseInt(alto_foto) + parseInt(altoPie) + 60;
if (altoBloqueCentral <= dimensionesPEP.alto)
{
document.getElementById('ampliar').style.display = 'none';
if (dispositivoMovil)
{
capaFlotante.style.top =  Math.round(YscrollVertical + (dimensionesPEP.alto - altoBloqueCentral ) / 2 ) + 'px';
}
else
capaFlotante.style.top =  (Math.round(dimensionesPEP.alto / 2 - altoBloqueCentral / 2)) + 'px' ;
capaFlotante.style.left = '0px';
document.getElementById('imagen_contenedor').style.height = alto_foto + 'px';
document.getElementById('imagen_contenedor').style.width = ancho_foto + 'px';
document.getElementById('flotante_foto').style.width = (parseInt(ancho_foto) + 20) + "px";
}
else
{
if (dispositivoMovil)
{
capaFlotante.style.top =  YscrollVertical + 'px';
}
else
capaFlotante.style.top = '0px' ;
altoPie = 55;
var imgH = dimensionesPEP.alto - parseInt(altoPie) - 60;
var imgW = Math.round(imgH * ancho_foto / alto_foto);
document.getElementById('imagen_contenedor').style.height = imgH + "px";
document.getElementById('imagen_contenedor').style.width = imgW + "px";
document.getElementById('flotante_foto').style.width = (imgW + 20) + "px";
document.getElementById('ampliar').style.display = 'block';
document.getElementById('ampliar').onclick = function (e) {
bloqueaClick(e);
if (!fotoTamanioReal)
{
document.getElementById('ampliar').className = 'boton reducir';
document.getElementById('ampliar').innerHTML = LANG_MSG[LANG].tamanio_ventana;
capaFlotante.style.position = 'absolute';
capaFlotante.style.top = YscrollVertical + 'px';
document.getElementById('flotante_foto').style.width = (parseInt(ancho_foto) + 20) + "px";
document.getElementById('imagen_contenedor').style.width = ancho_foto + 'px';
document.getElementById('imagen_contenedor').style.height = alto_foto + 'px';
}
else
{
document.getElementById('ampliar').className = 'boton ampliar';
document.getElementById('ampliar').innerHTML= LANG_MSG[LANG].tamanio_real;
if (dispositivoMovil)
{
capaFlotante.style.position = 'absolute';
capaFlotante.style.top = YscrollVertical + 'px';
}
else
{
capaFlotante.style.position = 'fixed';
capaFlotante.style.top = '0px';
}
document.getElementById('imagen_contenedor').style.height = (dimensionesPEP.alto - parseInt(altoPie) - 60) + "px";
document.getElementById('imagen_contenedor').style.width = imgW + "px";
document.getElementById('flotante_foto').style.width = (imgW + 20) + "px";
}
fotoTamanioReal = !fotoTamanioReal;
};
}
document.getElementById('imagen_contenedor').onclick = bloqueaClick;
document.getElementById('imagen_contenedor').src    = url_foto;
if (window.addEventListener)
{
window.addEventListener('keydown', teclaTelonEvent,true);
}
else
{
document.onkeydown = teclaPulsada;
}
marcadoAmpliaFoto(document.getElementsByTagName('title')[0] ? document.getElementsByTagName('title')[0].innerHTML : "", url_foto);
}
}

function f_pinta_datos(nick, datosUsuario, idVentana, boton) {
var nombreCompleto = nick;
var descripcionUsuario = '';
var fotoUsuario = '';
if ( (datosUsuario.perfilesUsuarios) && (datosUsuario.perfilesUsuarios[nick]) )  {
datosUsuario = datosUsuario.perfilesUsuarios[nick];
var nombreUsuario    = datosUsuario.nombre;
var apellidosUsuario = datosUsuario.apellidos;
var descripcionUsuario = datosUsuario.descripcion;
var fotoUsuario = datosUsuario.pathfoto;
if (apellidosUsuario != '') {
nombreCompleto = apellidosUsuario + ', ' + nombreUsuario;
}
else {
if (nombreUsuario != '') {
nombreCompleto = nombreUsuario;
}
}
}
var contenido_html = '';
contenido_html = contenido_html + '<div class="encabezado estirar">';
contenido_html = contenido_html + '<a onclick="javascript:document.getElementById(\'' + idVentana + '\').style.display=\'none\';" title="' + LANG_MSG[LANG].cerrar + '" class="autor" href="javascript:void(0);">' + nombreCompleto + '</a>';
contenido_html = contenido_html + '<a title="' +  LANG_MSG[LANG].ver_perfil_completo + '" href="//eskup.elpais.com/' + nick + '" target="_blank">' + LANG_MSG[LANG].ver_perfil_eskup + ' &raquo;</a>';
contenido_html = contenido_html + '<a onclick="javascript:document.getElementById(\'' + idVentana + '\').style.display=\'none\';" title="' + LANG_MSG[LANG].cerrar + '" class="cerrar" href="javascript:void(0);"></a>';
contenido_html = contenido_html + '</div><!-- === .encabezado === -->';
contenido_html = contenido_html + '<div class="contenido estirar">';
if (fotoUsuario != '' ) {
contenido_html = contenido_html + '<div class="foto"><img width="100" height="100" src="' + fotoUsuario + '" alt="' + LANG_MSG[LANG].avatar + '"></div><!-- === .foto === -->';
}
contenido_html = contenido_html + '<p>' + descripcionUsuario + '</p>';
contenido_html = contenido_html + '</div><!-- === .contenido === -->';
var posX = boton.offsetLeft;
var posY = boton.offsetTop;
if (posY < 0) {
posY = 0;
}
var panel = document.getElementById(idVentana);
panel.innerHTML = contenido_html;
panel.style.display = 'block';
panel.style.top  = posY + 'px';
panel.style.left = posX + 'px';
}
function f_muestra_ficha_colaborador(nick, idDiv, boton) {
var urlEskup = '/Profileeskup';
var date_actual  = new Date();
var ts_actual = date_actual.getTime();
var cadena_params = 'action=info_usuarios&user=' + nick;
cadena_params += '&ts=' + parseInt(ts_actual);
EPETUtils_makeHttpRequestGet(function(httpRequest) {
if (httpRequest.status != 200) {
var hashDatos = {};
f_pinta_datos(nick, hashDatos, idDiv, boton);
}
else {
var hashDatos = Array();
var data = httpRequest.responseText;
eval("_hashDatos = " + data);
f_pinta_datos(nick, _hashDatos, idDiv, boton);
}
}, urlEskup + "?" + cadena_params);
}
function f_comprobar_submit(evento, idFormulario, idCampoLogin, idCampoPasswd) {
if (window.event) {
tecla = evento.keyCode;
src   = evento.srcElement;
}
else if (evento.which) {
tecla = evento.which;
src   = evento.target;
}
if (tecla == 13) {
f_iniciar_sesion(idFormulario, idCampoLogin, idCampoPasswd);
}
}
function f_iniciar_sesion(idFormulario, idCampoLogin, idCampoPasswd) {
var campoLogin  = document.getElementById(idCampoLogin);
var campoPasswd = document.getElementById(idCampoPasswd);
if ( (campoLogin.value == '') || (campoPasswd.value == '') )  {
alert(LANG_MSG[LANG].teclear_usuario);
return false;
}
var valor_usuario = campoLogin.value;
if ( valor_usuario.match(/(\w*)@(\w+)/) ) {
var formulario = document.getElementById(idFormulario);
formulario.submit();
}
else {
alert(LANG_MSG[LANG].error_correo);
return false;
}
}


function EPETUtils_filtraAlfanumerico (datos_contaminados)
{
var datos_filtrados= datos_contaminados.replace(/[^a-z0-9_ñÑáÁéÉíÍóÓúÚüÜ]/g, "");
return datos_filtrados;
}

function EPETUtils_filtraJavascript (datos_contaminados)
{
var datos_filtrados= datos_contaminados.replace(/[';"]/g, "");
return datos_filtrados;
}

function EPETUtils_filtraFormulario (datos_contaminados)
{
var datos_filtrados= datos_contaminados.replace(/[<>"=]/g, "");
return datos_filtrados;
}
var JSON = JSON || {};
JSON.stringify = JSON.stringify || function (obj) {
var t = typeof (obj);
if (t != "object" || obj === null) {
if (t == "string") obj = '"'+obj+'"';
return String(obj);
}
else {
var n, v, json = [], arr = (obj && obj.constructor == Array);
for (n in obj) {
v = obj[n]; t = typeof(v);
if (t == "string") v = '"'+v+'"';
else if (t == "object" && v !== null) v = JSON.stringify(v);
json.push((arr ? "" : '"' + n + '":') + String(v));
}
return (arr ? "[" : "{") + String(json) + (arr ? "]" : "}");
}
};
JSON.parse = JSON.parse || function (str) {
if (str === "") str = '""';
eval("var p=" + str + ";");
return p;
};
if (typeof(launchAjaxOMN) != 'function')
{
try{
if (typeof(parent) != "undefined" && typeof(parent.launchAjaxOMN) == 'function')
{
launchAjaxOMN = parent.launchAjaxOMN;
}
}
catch(err)
{}
}
function loadCSS(archivo_css, callback, hls) {
if (hls && typeof(Hls) == "undefined")
{
var ss = document.createElement('script');
ss.type= 'text/javascript';
ss.src = '//ep02.epimg.net/js/hls/hls.js';
document.getElementsByTagName('head')[0].appendChild(ss);
}
var head = document.getElementsByTagName('head')[0];
var link = document.createElement('link');
link.type = "text/css";
link.rel = "stylesheet"
link.href = archivo_css;
if (link.addEventListener)
{
link.addEventListener('load', callback, false);
}
else
{
if (link.onload) {
link.onload = callback;
}
else
{
if (isIE)
{
link.onreadystatechange = function() {
var state = link.readyState;
if (state === 'loaded' || state === 'complete') {
callback();
link.onreadystatechange = null;
}
}
}
else
{
var cssnum = document.styleSheets.length;
var ti = setInterval(function() {
if (document.styleSheets.length > cssnum) {
callback();
clearInterval(ti);
}
}, 30);
}
}
}
head.appendChild(link);
}
var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,u,a;var f=0;e=Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){var t="";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){var t="";var n=0;var r=c1=c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}}
function loadEmbedObjectInDiv(nombreId, str)
{
var objDiv = document.getElementById(nombreId);
if (objDiv)
{
objDiv.innerHTML = str;
}
}
function loadEmbedObjectInDivResponsive(nombreId, str, responsive)
{
var objDiv = document.getElementById(nombreId);
if (objDiv)
{
if (responsive)
{
var anchoIf = /width=["']?(\d+)["']?/i;
var altoIf = /height=["']?(\d+)["']?/i;
var anchoViejo;
var altoViejo;
var anchoNuevo;
var altoNuevo;
var res = anchoIf.exec(str);
var res2;
if (res)
{
anchoViejo = res[1];
res2 = altoIf.exec(str);
if (res2)
altoViejo = res2[1];
else
altoViejo = Math.floor(anchoViejo * 9 / 16);
altoNuevo = Math.floor(objDiv.offsetWidth * altoViejo / anchoViejo);
anchoNuevo = objDiv.offsetWidth;
str = str.replace(/width=(['"]?)\d+(['"]?)/ig, "width=$1" + anchoNuevo + "$2");
str = str.replace(/height=(['"]?)\d+(['"]?)/ig, "height=$1" + altoNuevo + "$2");
str = str.replace(/w=\d+/ig, "w=" + anchoNuevo);
str = str.replace(/h=\d+/ig, "h=" + altoNuevo);
}
}
objDiv.innerHTML = str;
}
}
function reproductorMultimedia(datosMultimedia, divMultimedia)
{
var id_div_ReproductorMultimedia;
if (typeof(divMultimedia) == "undefined" )
{
id_div_ReproductorMultimedia = "multimediaPlayer_" + String(Math.random()).substr(2,9);
document.write('<div id="' + id_div_ReproductorMultimedia + '"></div>');
}
else
id_div_ReproductorMultimedia = divMultimedia;
if (typeof(datosMultimedia.urls) == "undefined")
datosMultimedia.urls = [];
datosMultimedia.url_cache = url_cache;
if (typeof(id_cuenta_mediateca_PEP) != "undefined")
{
datosMultimedia.id_cuenta_mediateca_PEP = id_cuenta_mediateca_PEP;
datosMultimedia.id_player_mediateca_PEP = id_player_mediateca_PEP;
}
if (datosMultimedia.un_creacion && datosMultimedia.portal_creacion && datosMultimedia.seccion_creacion && typeof(videoLayerMPEP) != "undefined")
{
if (datosMultimedia.portal_creacion == "elpais" || datosMultimedia.portal_creacion == "ccaa")
{
if (typeof(videoLayerMPEP[datosMultimedia.un_creacion + "-" + datosMultimedia.portal_creacion + "-" + datosMultimedia.seccion_creacion])!= "undefined")
{
datosMultimedia.url_cache = videoLayerMPEP[datosMultimedia.un_creacion + "-" + datosMultimedia.portal_creacion + "-" + datosMultimedia.seccion_creacion].url_cache;
if (typeof(id_cuenta_mediateca_PEP))
{
datosMultimedia.id_cuenta_mediateca_PEP = videoLayerMPEP[datosMultimedia.un_creacion + "-" + datosMultimedia.portal_creacion + "-" + datosMultimedia.seccion_creacion].id_cuenta_mediateca_PEP;
datosMultimedia.id_player_mediateca_PEP = videoLayerMPEP[datosMultimedia.un_creacion + "-" + datosMultimedia.portal_creacion + "-" + datosMultimedia.seccion_creacion].id_player_mediateca_PEP;
}
}
}
else
if (typeof(videoLayerMPEP[datosMultimedia.un_creacion + "-" + datosMultimedia.portal_creacion])!= "undefined")
{
datosMultimedia.url_cache = videoLayerMPEP[datosMultimedia.un_creacion + "-" + datosMultimedia.portal_creacion].url_cache;
if (typeof(id_cuenta_mediateca_PEP))
{
datosMultimedia.id_cuenta_mediateca_PEP = videoLayerMPEP[datosMultimedia.un_creacion + "-" + datosMultimedia.portal_creacion].id_cuenta_mediateca_PEP;
datosMultimedia.id_player_mediateca_PEP = videoLayerMPEP[datosMultimedia.un_creacion + "-" + datosMultimedia.portal_creacion].id_player_mediateca_PEP;
}
}
}
switch(datosMultimedia.tipo)
{
case "video":
if (datosMultimedia.caratula.indexOf('/') == 0 && datosMultimedia.caratula.substr(0,2) != "//")
datosMultimedia.caratula = datosMultimedia.url_cache + datosMultimedia.caratula;
datosMultimedia.poster = datosMultimedia.caratula;
if (datosMultimedia.id_referencia)
datosMultimedia.idRefBrightcove = datosMultimedia.id_referencia;
if (datosMultimedia.keywords)
datosMultimedia.keywordsVideo = datosMultimedia.keywords;
if (typeof(datosMultimedia.id_referencia) == "undefined" && datosMultimedia.id_multimedia && datosMultimedia.id_multimedia.indexOf("_") == -1)
datosMultimedia.id_video = datosMultimedia.id_multimedia;
if (typeof(datosMultimedia.playerEPETParams) != "undefined")
datosMultimedia.playerEPETParams["URLMediaStill"] = datosMultimedia.poster;
else
datosMultimedia.playerEPETParams = {"URLMediaStill":datosMultimedia.poster};
setTimeout(function(){var video = new EPET_Video(datosMultimedia, id_div_ReproductorMultimedia);},300);
break;
case "externo": case "iframe":
if ((typeof(datosMultimedia.urls) != "undefined" && typeof(datosMultimedia.urls[0]) != "undefined") || typeof(datosMultimedia.codigo) != "undefined")
{
var str;
if (datosMultimedia.tipo == 'iframe') {
str = datosMultimedia.codigo;
}
else
str = datosMultimedia.urls[0];
if (str.substr(-4,4) == "m3u8")
{
document.getElementById(id_div_ReproductorMultimedia).className = "MPEP_video_vacio";
return;
}
else
{
document.getElementById(id_div_ReproductorMultimedia).className = "MPEP_video_externo";
}
var srcIf = /src=["']?([^"']+)["']?/i;
var res1 = srcIf.exec(str);
if (str.indexOf("http") == 0 || res1)
{
var factor = 9/16;
var url;
if (res1)
{
var anchoIf = /width=["']?([\d\%]+)["']?/i;
var altoIf = /height=["']?([\d\%]+)["']?/i;
var res2 = anchoIf.exec(str);
var res3 = altoIf.exec(str);
if (res2 && res3 && res2[1].match(/^\d+$/) && res3[1].match(/^\d+$/))
factor = res3[1]/res2[1];
url = res1[1];
}
else
{
url = arreglaUrl(str);
}
var ifr = document.createElement("iframe");
ifr.width = "100%";
ifr.height = "100%";
ifr.setAttribute("frameBorder", "0");
ifr.setAttribute("scrolling", "no");
ifr.setAttribute("webkitallowfullscreen", "");
ifr.setAttribute("mozallowfullscreen", "");
ifr.setAttribute("allowfullscreen", "");
ifr.style.position = 'absolute';
if (document.location.href.indexOf("autoplay=1") > -1 && !reproduciendo)
{
reproduciendo = true;
datosMultimedia.autoplay = true;
setTimeout(function(){
var posVideo = EPET_calculaTopPosition(document.getElementById(id_div_ReproductorMultimedia));
if (posVideo > dimensionesPEP.alto)
EPET_setScrollPosition(parseInt(posVideo) - 90);
if (typeof(window.lzld) == 'function')
{
setTimeout(function(){
var posVideo = EPET_calculaTopPosition(document.getElementById(id_div_ReproductorMultimedia));
EPET_setScrollPosition(parseInt(posVideo) - 90);
},800);
}
},300);
}
if (datosMultimedia.autoplay)
{
if (url.match(/muzu/i))
{
url = url.replace(/&(amp;)?autostart=n/,"");
url += "&autostart=y";
}
else
if (url.match(/youtu/i))
url += "?autoplay=1";
}
if (url.match(/youtu/i))
{
if(url.indexOf('?') > -1)
url += "&wmode=transparent";
else
url += "?wmode=transparent";
}
document.getElementById(id_div_ReproductorMultimedia).style.position = 'relative';
document.getElementById(id_div_ReproductorMultimedia).style.width = '100%';
document.getElementById(id_div_ReproductorMultimedia).style.height = '100%';
document.getElementById(id_div_ReproductorMultimedia).style.paddingBottom = (factor * 100) + "%";
document.getElementById(id_div_ReproductorMultimedia).appendChild(ifr);
ifr.src = url;
}
else
document.getElementById(id_div_ReproductorMultimedia).parentNode.innerHTML = str;
}
break;
case tipo_player_mediateca_PEP:
if (document.location.href.indexOf("autoplay=1") > -1 && !reproduciendo)
{
reproduciendo = true;
datosMultimedia.autoplay = true;
setTimeout(function(){
var posVideo = EPET_calculaTopPosition(document.getElementById(id_div_ReproductorMultimedia));
if (posVideo > dimensionesPEP.alto)
EPET_setScrollPosition(parseInt(posVideo));
if (typeof(window.lzld) == 'function')
{
setTimeout(function(){
var posVideo = EPET_calculaTopPosition(document.getElementById(id_div_ReproductorMultimedia));
EPET_setScrollPosition(parseInt(posVideo));
},1000);
}
},600);
}
else
{
if (typeof(datosMultimedia.autoplay) == "undefined")
datosMultimedia.autoplay = false;
}
var regexpNoticia = /http.?:\/\/([^\/]*)\/([^\/]*)\/(\d+)\/(\d+)\/(\d+)\/([^\/]*)\/.*\.html/i;
if (typeof(datosMultimedia.urlNoticia) == "undefined" || regexpNoticia.exec(document.location.href))
datosMultimedia.urlNoticia = "";
else
datosMultimedia.urlNoticia = datosMultimedia.urlNoticia + "?autoplay=1";
if (typeof(datosMultimedia.caratula) == "undefined")
datosMultimedia.caratula = "";
if (typeof(datosMultimedia.publiActiva) == "undefined")
datosMultimedia.publiActiva = false;
if (typeof(datosMultimedia.keywordsVideo) == "undefined")
datosMultimedia.keywordsVideo = "";
var datosTOP = {
"id_container": id_div_ReproductorMultimedia,
"id_cuenta": datosMultimedia.id_cuenta_mediateca_PEP,
"id_player": datosMultimedia.id_player_mediateca_PEP,
"id_media": datosMultimedia.id_multimedia,
"media_type": "video",
"keywords": datosMultimedia.keywordsVideo,
"topPlayer":{
"media" : {
"autoplay": datosMultimedia.autoplay,
"ancho": datosMultimedia.anchoPlayer,
"alto": datosMultimedia.altoPlayer
},
"ad": {
"enabled": datosMultimedia.publiActiva,
"tags_noticia": (typeof(listado_norm_tags) != "undefined" ? listado_norm_tags : (typeof(listadoKW) != "undefined" ? listadoKW:""))
}
},
"dev" : false
};
if (!mediateca)
mediateca =  typeof(psd) != "undefined" &&  typeof(psd.media) != "undefined" && typeof(psd.media.TopEmbedManager) != "undefined"? new psd.media.TopEmbedManager() : null;
if (mediateca)
mediateca.add(datosTOP, [datosMultimedia.caratula, datosMultimedia.urlNoticia]);
else
videosMediateca.push({"datosTOP":datosTOP, "params":[datosMultimedia.caratula, datosMultimedia.urlNoticia]});
break;
default:
break;
}
}
function aniade_track_caja(id_componente, track) {
if (document.getElementById(id_componente)) {
var caja = document.getElementById(id_componente);
if (caja.getElementsByTagName("a")) {
var enlaces = caja.getElementsByTagName("a");
for(var index in enlaces) {
var elemento = enlaces[index];
if (typeof(elemento) == 'object' && elemento.getAttribute('href')) {
var hrefInicial = elemento.getAttribute('href');
if (hrefInicial.substring(0, 4) != "java") {
var hrefFinal = "";
if (hrefInicial.indexOf('?') > -1) {
hrefFinal = hrefInicial + "&" + track;
} else {
hrefFinal = hrefInicial + "?" + track;
}
elemento.setAttribute('href',hrefFinal);
}
}
}
}
}
}

widgetInstagram = function () {
var opt = null,width,col,fill,showSiguenos,showEnInstagram;
ul_css = function () {
var css = {
"width": width,
};
return css;
};
li_css = function () {
var css = {
"width": "calc(100%/" + opt.col + ")",
};
return css;
};
img_css = function () {
var css = {

};
return css;
};
p_css = function () {
var css = {

};
return css;
};
createDOM = function (data) {
var div_content = document.createElement("div");
div_content.classList.add("widget","widget_instagram");
var div_interior = document.createElement("div");
var p;
if (data.hasOwnProperty("error_type")) {
var text_error = document.createTextNode(data.error_message);
p = document.createElement("p");
p.appendChild(text_error);
} else {
div_interior.classList.add("widget__interior");
var h3 = document.createElement("h3");
var span_h3 = document.createElement("span");
span_h3.classList.add("sin_enlace");
var span_h3_text = document.createTextNode("En Instagram");
span_h3.appendChild(span_h3_text);
h3.appendChild(span_h3);
var ul = document.createElement("ul");
var ul_css_value = ul_css();
for (var prop in ul_css_value) {
ul.style[prop] = ul_css_value[prop];
}
for (var index in data) {
if (data.hasOwnProperty(index)) {
var img = document.createElement("img");
img.title = data[index].caption !== null && data[index].caption.hasOwnProperty("text") ? data[index].caption.text : "";
img.alt = data[index].caption !== null && data[index].caption.hasOwnProperty("text") ? data[index].caption.text : "";
img.src = data[index].images.thumbnail.url;
img.style.maxWidth = data[index].images.thumbnail.width + "px";
var img_css_value = img_css();
for (var prop in img_css_value) {
img.style[prop] = img_css_value[prop];
}
var a_li = document.createElement("a");
a_li.target = "_blank";
a_li.href = data[index].link;
a_li.appendChild(img);
var li = document.createElement("li");
var li_css_value = li_css();
for (var prop in li_css_value) {
li.style[prop] = li_css_value[prop];
}
li.appendChild(a_li);
ul.appendChild(li);
}
}
var a_p_text = document.createTextNode("S\u00EDguenos");
p = document.createElement("a");
p.target = "_blank";
p.href = "//instagram.com/" + data[0].user.username;
p.classList.add("widget-seguir");
p.rel = "nofollow";
p.appendChild(a_p_text);
if(showEnInstagram){
div_interior.appendChild(h3);
}
div_interior.appendChild(ul);
div_content.appendChild(div_interior);
}
if(showSiguenos){
div_interior.appendChild(p);
}
return div_content;
};
jsonpv2 = function (callback) {
var element;
var xhttp;
xhttp = new XMLHttpRequest();
xhttp.open("GET", "/widgets/instagram/instagram-" + opt.token + ".js?callback=jsonp_callback_" + Math.round(100000 * Math.random()),true);
xhttp.send();
xhttp.onreadystatechange = function() {
if (xhttp.readyState == 4 && xhttp.status == 200) {
var json_response = JSON.parse(xhttp.response);
element = createDOM(json_response.data);
}else if(xhttp.status == 404){
element = document.createElement( 'html' );
element.innerHTML = xhttp.response;
}
callback(element);
};
};
this.config = function (options) {
opt = options;
width = opt.hasOwnProperty("width") ? opt.width : "100%";
col = opt.hasOwnProperty("col") ? opt.col : 1;
fill = opt.hasOwnProperty("fill") ? opt.fill : 1;
showSiguenos = typeof opt.showSiguenos === "undefined" || opt.showSiguenos === "" ? true : opt.showSiguenos;
showEnInstagram = typeof opt.showEnInstagram === "undefined" || opt.showEnInstagram === "" ? true : opt.showEnInstagram;
};
this.run = function () {
jsonpv2(function (response) {
if(opt.hasOwnProperty("element") && document.getElementById(opt.element) !== null){
document.getElementById(opt.element).appendChild(response);
}else if(opt.hasOwnProperty("element") && document.getElementsByClassName(opt.element).length > 0){
document.getElementsByClassName(opt.element)[0].appendChild(response);
}else{
document.getElementById('div_instagram_default').appendChild(response);
}
});
};
};


widgetFacebook = function () {
var opt = null,showEnFacebook,showSiguenos;
createDOMWidgetFacebook = function(){
var div_fb_page = document.createElement('div');
div_fb_page.classList.add("fb-page");
div_fb_page.dataset.href = typeof opt.user === "undefined" ? "None" : "https://www.facebook.com/" + opt.user;
div_fb_page.dataset.width = typeof opt.width === "undefined" ? "340" : opt.width;
div_fb_page.dataset.height = typeof opt.height === "undefined" ? "500" : opt.height;
div_fb_page.dataset.tabs = typeof opt.tabs === "undefined" ? "" : opt.tabs;
div_fb_page.dataset.hideCover = typeof opt.hideCover === "undefined" ? "false" : opt.hideCover;
div_fb_page.dataset.showFacepile = typeof opt.showFacepile === "undefined" ? "true" : opt.showFacepile;
div_fb_page.dataset.hideCta = typeof opt.hideCta === "undefined" ? "true" : opt.hideCta;
div_fb_page.dataset.smallHeader = typeof opt.smallHeader === "undefined" ? "false" : opt.smallHeader;
div_fb_page.dataset.adaptContainerWidth = typeof opt.adaptContainerWidth === "undefined" ? "true" : opt.adaptContainerWidth;
div_fb_page.dataset.stream = typeof opt.stream === "undefined" ? "false" : opt.stream;
div_fb_page.dataset.header = typeof opt.header === "undefined" ? "false" : opt.header;
showEnFacebook = typeof opt.showEnFacebook === "undefined" || opt.showEnFacebook === "" ? true : opt.showEnFacebook;
showSiguenos = typeof opt.showSiguenos === "undefined" || opt.showSiguenos === "" ? true : opt.showSiguenos;
var div_fb_xfbml = document.createElement('div');
div_fb_xfbml.classList.add("fb-xfbml-parse-ignore");
var blockquote = document.createElement('blockquote');
blockquote.cite = "http://www.facebook.com/" + opt.user;
var a = document.createElement('a');
a.href = "http://www.facebook.com/" + opt.user;
blockquote.appendChild(a);
div_fb_xfbml.appendChild(blockquote);
div_fb_page.appendChild(div_fb_xfbml);
return div_fb_page;
}
createDOM = function (callback) {
var js, fjs = document.getElementsByTagName('script')[0];
if (!document.getElementById('facebook-jssdk')) {
js = document.createElement('script'); js.id = 'facebook-jssdk';
js.async = true; js.src = "//connect.facebook.net/es_ES/sdk.js#xfbml=1&version=v2.5";
fjs.parentNode.insertBefore(js, fjs);
}
var existeDivPrincipal = document.getElementsByClassName('widget_facebook')[0];
if (!existeDivPrincipal) {
var div_content = document.createElement("div");
div_content.classList.add("widget","widget_facebook");
}
var div_interior = document.createElement("div");
div_interior.classList.add("widget__interior");
var h3 = document.createElement("h3");
var span_h3 = document.createElement("span");
span_h3.classList.add("sin_enlace");
var span_h3_text = document.createTextNode("En Facebook");
span_h3.appendChild(span_h3_text);
h3.appendChild(span_h3);
var div_fb_root = document.createElement('div');
div_fb_root.id = "fb-root";
var div_fb_page = createDOMWidgetFacebook();
var a_p_text = document.createTextNode("S\u00EDguenos");
p = document.createElement("a");
p.target = "_blank";
p.href = "//www.facebook.com/" + opt.user;
p.classList.add("widget-seguir");
p.rel = "nofollow";
p.appendChild(a_p_text);
if(showEnFacebook){
div_interior.appendChild(h3);
}
div_interior.appendChild(div_fb_root);
div_interior.appendChild(div_fb_page);
if(showSiguenos){
div_interior.appendChild(p);
}
if (!existeDivPrincipal) {
div_content.appendChild(div_interior);
return div_content;
}else{
return div_interior;
}
};
this.config = function (options) {
opt = options;
};
this.run = function () {
var response = createDOM();
if(opt.hasOwnProperty("element") && document.getElementById(opt.element) !== null){
document.getElementById(opt.element).appendChild(response);
}else if(opt.hasOwnProperty("element") && document.getElementsByClassName(opt.element).length > 0){
document.getElementsByClassName(opt.element)[0].appendChild(response);
}else{
document.getElementById('div_facebook_default').appendChild(response);
}
};
};

(function () {
'use strict';
var keyboardAllowed = typeof Element !== 'undefined' && 'ALLOW_KEYBOARD_INPUT' in Element;
var fn = (function () {
var val;
var valLength;
var fnMap = [
[
'requestFullscreen',
'exitFullscreen',
'fullscreenElement',
'fullscreenEnabled',
'fullscreenchange',
'fullscreenerror'
],
[
'webkitRequestFullscreen',
'webkitExitFullscreen',
'webkitFullscreenElement',
'webkitFullscreenEnabled',
'webkitfullscreenchange',
'webkitfullscreenerror'
],
[
'webkitRequestFullScreen',
'webkitCancelFullScreen',
'webkitCurrentFullScreenElement',
'webkitCancelFullScreen',
'webkitfullscreenchange',
'webkitfullscreenerror'
],
[
'mozRequestFullScreen',
'mozCancelFullScreen',
'mozFullScreenElement',
'mozFullScreenEnabled',
'mozfullscreenchange',
'mozfullscreenerror'
],
[
'msRequestFullscreen',
'msExitFullscreen',
'msFullscreenElement',
'msFullscreenEnabled',
'MSFullscreenChange',
'MSFullscreenError'
]
];
var i = 0;
var l = fnMap.length;
var ret = {};
for (; i < l; i++) {
val = fnMap[i];
if (val && val[1] in document) {
for (i = 0, valLength = val.length; i < valLength; i++) {
ret[fnMap[0][i]] = val[i];
}
return ret;
}
}
return false;
})();
var screenfull = {
request: function (elem) {
var request = fn.requestFullscreen;
elem = elem || document.documentElement;
if (/5\.1[\.\d]* Safari/.test(navigator.userAgent)) {
elem[request]();
} else {
elem[request](keyboardAllowed && Element.ALLOW_KEYBOARD_INPUT);
}
},
exit: function () {
document[fn.exitFullscreen]();
},
toggle: function (elem) {
if (this.isFullscreen) {
this.exit();
} else {
this.request(elem);
}
},
raw: fn,
func:null
};
if (!fn) {
window.screenfull = false;
return;
}
Object.defineProperties(screenfull, {
isFullscreen: {
get: function () {
return !!document[fn.fullscreenElement];
}
},
element: {
enumerable: true,
get: function () {
return document[fn.fullscreenElement];
}
},
enabled: {
enumerable: true,
get: function () {
return !!document[fn.fullscreenEnabled];
}
}
});
window.screenfull = screenfull;
})();
